# 零售業簡易ERP系統 - 基礎資料模組 SA文件

**文件版本**: v1.0
**建立日期**: 2025-12-31
**模組代碼**: M02
**關聯主文件**: [SA_00_主文件.md](SA_00_主文件.md)

---

## 目錄

1. [模組概述](#1-模組概述)
2. [商品管理](#2-商品管理)
3. [分類管理](#3-分類管理)
4. [客戶/會員管理](#4-客戶會員管理)
5. [供應商管理](#5-供應商管理)
6. [基礎設定](#6-基礎設定)
7. [資料表設計](#7-資料表設計)
8. [API規格](#8-api規格)

---

## 1. 模組概述

### 1.1 模組說明

基礎資料模組是系統的核心資料模組，提供商品、分類、客戶、供應商等主檔資料的維護功能。其他模組（銷售、庫存、採購）皆依賴此模組的基礎資料。

### 1.2 功能清單

| 功能代碼 | 功能名稱 | 優先順序 |
|---------|---------|:-------:|
| F02-001 | 商品分類管理 | P0 |
| F02-002 | 單位管理 | P0 |
| F02-003 | 付款方式管理 | P0 |
| F02-004 | 稅別管理 | P0 |
| F02-005 | 倉庫管理 | P0 |
| F02-006 | 編號規則設定 | P1 |
| F03-001 | 商品主檔 | P0 |
| F03-002 | 商品規格管理 | P1 |
| F03-003 | 價格管理 | P0 |
| F03-004 | 商品組合/套餐 | P2 |
| F03-005 | 商品匯入匯出 | P1 |
| F03-006 | 商品條碼管理 | P0 |
| F03-007 | 商品標籤列印 | P2 |
| F03-008 | 商品查詢 | P0 |

### 1.3 模組關聯

```
                    ┌─────────────────┐
                    │   基礎資料模組   │
                    └────────┬────────┘
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
         ▼                   ▼                   ▼
    ┌─────────┐        ┌─────────┐        ┌─────────┐
    │ 銷售模組 │        │ 庫存模組 │        │ 採購模組 │
    │ (商品、 │        │ (商品、 │        │ (商品、 │
    │  客戶)  │        │  倉庫)  │        │  供應商) │
    └─────────┘        └─────────┘        └─────────┘
```

---

## 2. 商品管理

### 2.1 商品主檔 (F03-001)

**功能說明**: 管理商品基本資料，包含名稱、規格、價格、圖片等完整資訊。

#### 輸入欄位 - 基本資訊

| 欄位名稱 | 資料型態 | 必填 | 驗證規則 |
|---------|---------|:----:|---------|
| 商品編號 | VARCHAR(30) | Y | 唯一值、可自訂或自動產生 |
| 商品條碼 | VARCHAR(30) | N | 唯一值、支援EAN-13/UPC |
| 商品名稱 | NVARCHAR(200) | Y | 1-200字元 |
| 商品簡稱 | NVARCHAR(50) | N | POS顯示用 |
| 商品分類 | INT (FK) | Y | 關聯分類表 |
| 品牌 | NVARCHAR(50) | N | - |
| 規格說明 | NVARCHAR(500) | N | - |
| 計量單位 | VARCHAR(10) | Y | 關聯單位表 |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE/DISCONTINUED |

#### 輸入欄位 - 價格資訊

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 成本價 | DECIMAL(12,2) | Y | 最新進貨成本 |
| 標準售價 | DECIMAL(12,2) | Y | 定價 |
| 最低售價 | DECIMAL(12,2) | N | 促銷底價 |
| 會員價 | DECIMAL(12,2) | N | 會員專屬價 |
| 稅別 | VARCHAR(10) | Y | 關聯稅別表 |

#### 輸入欄位 - 庫存資訊

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 安全庫存量 | INT | N | 低於此量發出警示 |
| 最大庫存量 | INT | N | 建議庫存上限 |
| 庫存管理 | BOOLEAN | Y | 是否啟用庫存扣減 |

#### 輸入欄位 - 其他資訊

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 供應商 | INT (FK) | N | 主要供應商 |
| 商品圖片 | VARCHAR(500) | N | 圖片URL |
| 備註 | TEXT | N | - |

#### 業務規則

| 規則編號 | 規則說明 |
|---------|---------|
| BR01 | 商品編號建立後不可修改 |
| BR02 | 有庫存或交易紀錄的商品不可刪除，僅能停用 |
| BR03 | 成本價變動需記錄歷史 |
| BR04 | 條碼需驗證格式正確性 |
| BR05 | 售價不可低於成本價 (可設定警示) |

#### 畫面示意

```
┌─────────────────────────────────────────────────────────────────┐
│ 商品主檔維護                                    [儲存] [取消]    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ┌─ 基本資訊 ─────────────────────────────────────────────────┐ │
│ │ 商品編號: [PRD001        ] 自動產生 ☑                      │ │
│ │ 商品條碼: [4710088012345  ]                                │ │
│ │ 商品名稱: [經典白色T-Shirt                               ] │ │
│ │ 商品簡稱: [白T-Shirt     ]                                 │ │
│ │ 商品分類: [服飾 > 上衣 > T-Shirt        ▼]                 │ │
│ │ 品    牌: [自有品牌      ]                                 │ │
│ │ 計量單位: [件 ▼]                                           │ │
│ │ 狀    態: ● 啟用  ○ 停用  ○ 停產                           │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 價格資訊 ─────────────────────────────────────────────────┐ │
│ │ 成 本 價: [    150.00] 元   稅    別: [應稅 5% ▼]          │ │
│ │ 標準售價: [    299.00] 元   會 員 價: [    269.00] 元      │ │
│ │ 最低售價: [    199.00] 元                                  │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 庫存設定 ─────────────────────────────────────────────────┐ │
│ │ 啟用庫存管理: ☑                                            │ │
│ │ 安全庫存量: [      50]     最大庫存量: [     500]          │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 其他資訊 ─────────────────────────────────────────────────┐ │
│ │ 主要供應商: [ABC服飾批發商 ▼]                              │ │
│ │ 商品圖片: [選擇檔案] preview.jpg                           │ │
│ │ 備    註: [                                              ] │ │
│ └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

### 2.2 商品規格管理 (F03-002)

**功能說明**: 管理商品的多規格變體（如尺寸、顏色），自動產生SKU組合。

#### 規格架構

```
商品: T-Shirt 基本款
├── 規格1: 顏色 [白色, 黑色, 灰色]
└── 規格2: 尺寸 [S, M, L, XL]

產生 SKU:
- TSHIRT-WHITE-S   (白色-S)
- TSHIRT-WHITE-M   (白色-M)
- TSHIRT-WHITE-L   (白色-L)
- TSHIRT-WHITE-XL  (白色-XL)
- TSHIRT-BLACK-S   (黑色-S)
- ... (共12個SKU)
```

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 規格名稱 | NVARCHAR(50) | Y | 如：顏色、尺寸 |
| 規格選項 | JSON | Y | 選項陣列 |
| SKU編碼規則 | VARCHAR(100) | N | 自動產生規則 |

#### SKU管理欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| SKU編號 | VARCHAR(50) | Y | 唯一識別碼 |
| 父商品ID | INT (FK) | Y | 關聯主商品 |
| 規格組合 | JSON | Y | 如: {"顏色":"白色","尺寸":"M"} |
| 條碼 | VARCHAR(30) | N | 各SKU獨立條碼 |
| 成本價 | DECIMAL(12,2) | N | 可覆寫主商品價格 |
| 售價 | DECIMAL(12,2) | N | 可覆寫主商品價格 |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE |

---

### 2.3 價格管理 (F03-003)

**功能說明**: 管理商品的多種價格策略。

#### 價格類型

| 價格類型 | 說明 | 優先順序 |
|---------|------|:-------:|
| 促銷價 | 限時特價 | 1 (最高) |
| 會員價 | 會員專屬 | 2 |
| 量販價 | 購買數量達標 | 3 |
| 標準售價 | 一般定價 | 4 (最低) |

#### 促銷價設定欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品ID | INT (FK) | Y | - |
| 促銷價格 | DECIMAL(12,2) | Y | - |
| 開始日期 | DATETIME | Y | - |
| 結束日期 | DATETIME | Y | - |
| 適用門市 | JSON | N | NULL=全門市 |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE |

#### 量販價設定

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品ID | INT (FK) | Y | - |
| 最低數量 | INT | Y | 達到此數量適用 |
| 最高數量 | INT | N | NULL=無上限 |
| 單價 | DECIMAL(12,2) | Y | 量販單價 |

**範例**:
| 數量區間 | 單價 |
|---------|-----:|
| 1-9 件 | $299 |
| 10-49 件 | $269 |
| 50+ 件 | $249 |

---

### 2.4 商品組合/套餐 (F03-004)

**功能說明**: 建立商品組合銷售，支援套餐優惠。

#### 組合類型

| 類型 | 說明 | 範例 |
|------|------|------|
| 固定組合 | 固定商品組成 | 早餐套餐 = 漢堡+薯條+飲料 |
| 自選組合 | 可從選項中挑選 | 任選3件享優惠 |

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 組合編號 | VARCHAR(30) | Y | - |
| 組合名稱 | NVARCHAR(100) | Y | - |
| 組合類型 | ENUM | Y | FIXED/FLEXIBLE |
| 組合售價 | DECIMAL(12,2) | Y | 套餐價格 |
| 原價總計 | DECIMAL(12,2) | Y | 單買總價(顯示省多少) |
| 組成商品 | JSON | Y | 商品ID與數量 |
| 有效期間 | DATE | N | 起訖日期 |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE |

#### 組合明細結構

```json
{
  "type": "FIXED",
  "items": [
    { "product_id": 101, "quantity": 1, "required": true },
    { "product_id": 102, "quantity": 1, "required": true },
    { "product_id": 103, "quantity": 1, "required": true }
  ],
  "combo_price": 199,
  "original_price": 267
}
```

---

### 2.5 商品匯入匯出 (F03-005)

**功能說明**: 批次匯入匯出商品資料。

#### 支援格式

- Excel (.xlsx)
- CSV (.csv)

#### 匯入流程

```
1. 下載匯入範本
        │
        ▼
2. 填寫商品資料
        │
        ▼
3. 上傳檔案
        │
        ▼
4. 系統檢核資料 ─────┬─────────────────┐
        │            │                 │
        ▼            ▼                 ▼
    [全部通過]   [部分錯誤]       [全部錯誤]
        │            │                 │
        ▼            ▼                 ▼
  顯示預覽    顯示錯誤明細      顯示錯誤報告
  確認後匯入   可選擇忽略錯誤    重新上傳
        │         或修正
        ▼            │
5. 執行匯入 ◄────────┘
        │
        ▼
6. 顯示匯入結果
   (成功/失敗筆數)
```

#### 匯入範本欄位

| 欄位 | 必填 | 說明 |
|------|:----:|------|
| 商品編號 | Y | 新增時可空白自動產生 |
| 商品名稱 | Y | - |
| 商品條碼 | N | - |
| 分類代碼 | Y | 必須為系統已存在分類 |
| 計量單位 | Y | 必須為系統已存在單位 |
| 成本價 | Y | 數值 |
| 標準售價 | Y | 數值 |
| 會員價 | N | 數值 |
| 安全庫存 | N | 整數 |
| 供應商代碼 | N | 必須為系統已存在供應商 |
| 狀態 | N | ACTIVE/INACTIVE，預設ACTIVE |

#### 檢核規則

| 檢核項目 | 錯誤訊息 |
|---------|---------|
| 必填欄位空白 | 「{欄位名稱}」為必填欄位 |
| 商品編號重複 | 商品編號「{編號}」已存在 |
| 分類不存在 | 分類代碼「{代碼}」不存在 |
| 數值格式錯誤 | 「{欄位名稱}」必須為數值 |
| 條碼格式錯誤 | 條碼格式不正確 |
| 條碼重複 | 條碼「{條碼}」已被使用 |

---

### 2.6 商品條碼管理 (F03-006)

**功能說明**: 管理商品條碼，支援一品多碼。

#### 支援條碼類型

| 類型 | 位數 | 說明 |
|------|:---:|------|
| EAN-13 | 13 | 國際標準商品條碼 |
| EAN-8 | 8 | 短碼 |
| UPC-A | 12 | 美規條碼 |
| CODE39 | 可變 | 內部編碼 |
| CODE128 | 可變 | 內部編碼 |
| QR Code | 可變 | 二維條碼 |

#### 一品多碼設定

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品ID | INT (FK) | Y | - |
| 條碼 | VARCHAR(50) | Y | 唯一值 |
| 條碼類型 | ENUM | Y | - |
| 是否主條碼 | BOOLEAN | Y | 每商品僅一個主條碼 |
| 備註 | NVARCHAR(100) | N | 如：舊包裝條碼 |

---

### 2.7 商品標籤列印 (F03-007)

**功能說明**: 產生商品標籤供列印。

#### 標籤內容

- 商品名稱
- 商品條碼 (含條碼圖)
- 售價
- 規格 (選填)
- 產地 (選填)

#### 標籤規格

| 規格名稱 | 尺寸 | 適用場景 |
|---------|------|---------|
| 小標籤 | 30x20mm | 小型商品 |
| 標準標籤 | 50x30mm | 一般商品 |
| 貨架標籤 | 60x40mm | 貨架價格牌 |

#### 列印功能

| 功能 | 說明 |
|------|------|
| 單一列印 | 選擇商品後列印 |
| 批次列印 | 多選商品列印 |
| 指定數量 | 設定每商品列印張數 |
| 預覽 | 列印前預覽 |

---

### 2.8 商品查詢 (F03-008)

**功能說明**: 多條件查詢商品資料。

#### 查詢條件

| 條件 | 類型 | 說明 |
|------|------|------|
| 商品編號 | 文字 | 精確/模糊查詢 |
| 商品名稱 | 文字 | 模糊查詢 |
| 條碼 | 文字 | 精確查詢 |
| 分類 | 下拉 | 可多選 |
| 供應商 | 下拉 | 單選 |
| 價格區間 | 數值 | 起訖價格 |
| 狀態 | 下拉 | 啟用/停用/停產 |
| 庫存狀態 | 下拉 | 有庫存/缺貨/低於安全庫存 |
| 建立日期 | 日期 | 起訖日期 |

#### 查詢結果欄位

| 欄位 | 說明 |
|------|------|
| 商品編號 | - |
| 商品名稱 | - |
| 分類 | 完整路徑 |
| 條碼 | 主條碼 |
| 成本價 | - |
| 售價 | - |
| 庫存量 | 各倉庫合計 |
| 狀態 | - |
| 操作 | 編輯/檢視/停用 |

---

## 3. 分類管理

### 3.1 商品分類管理 (F02-001)

**功能說明**: 建立商品的階層式分類架構，支援多層級分類。

#### 分類結構 (支援無限層級)

```
服飾類
├── 上衣
│   ├── T-Shirt
│   ├── 襯衫
│   └── 外套
├── 下身
│   ├── 長褲
│   ├── 短褲
│   └── 裙子
└── 配件
    ├── 帽子
    ├── 包包
    └── 皮帶
```

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 分類代碼 | VARCHAR(20) | Y | 唯一值 |
| 分類名稱 | NVARCHAR(50) | Y | - |
| 父分類ID | INT | N | NULL表示頂層分類 |
| 排序 | INT | N | 同層級排序，預設0 |
| 圖示 | VARCHAR(100) | N | icon class或圖片URL |
| 狀態 | ENUM | Y | ACTIVE / INACTIVE |

#### 業務規則

| 規則編號 | 規則說明 |
|---------|---------|
| BR01 | 分類代碼建立後不可修改 |
| BR02 | 有子分類的分類不可刪除 |
| BR03 | 有商品的分類不可刪除，僅能停用 |
| BR04 | 停用父分類時，子分類一併停用 |
| BR05 | 建議層級不超過4層 |

#### 畫面示意

```
┌─────────────────────────────────────────────────────────────────┐
│ 商品分類管理                                    [新增頂層分類]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ▼ 服飾類 (CAT001)                           [編輯] [新增子分類]│
│    ├─ ▼ 上衣 (CAT001-01)                     [編輯] [新增子分類]│
│    │   ├─ T-Shirt (CAT001-01-01)             [編輯] [刪除]     │
│    │   ├─ 襯衫 (CAT001-01-02)                [編輯] [刪除]     │
│    │   └─ 外套 (CAT001-01-03)                [編輯] [刪除]     │
│    ├─ ▼ 下身 (CAT001-02)                     [編輯] [新增子分類]│
│    │   ├─ 長褲 (CAT001-02-01)                [編輯] [刪除]     │
│    │   └─ 短褲 (CAT001-02-02)                [編輯] [刪除]     │
│    └─ ▶ 配件 (CAT001-03)                     [編輯] [新增子分類]│
│                                                                 │
│  ▶ 食品類 (CAT002)                           [編輯] [新增子分類]│
│  ▶ 日用品 (CAT003)                           [編輯] [新增子分類]│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 客戶/會員管理

### 4.1 客戶/會員資料管理 (F07-001)

**功能說明**: 管理客戶與會員的基本資料。

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 會員編號 | VARCHAR(20) | Y | 自動產生或自訂 |
| 姓名 | NVARCHAR(50) | Y | - |
| 性別 | ENUM | N | M/F/OTHER |
| 生日 | DATE | N | 生日優惠用 |
| 手機 | VARCHAR(20) | Y | 唯一值、登入識別用 |
| Email | VARCHAR(100) | N | - |
| 地址 | NVARCHAR(200) | N | - |
| 會員等級 | INT (FK) | Y | 預設為初始等級 |
| 累積消費 | DECIMAL(14,2) | - | 系統自動計算 |
| 累積點數 | INT | - | 系統自動計算 |
| 可用點數 | INT | - | 系統自動計算 |
| 加入日期 | DATE | Y | 預設今日 |
| 加入門市 | INT (FK) | N | 來源門市 |
| 備註 | TEXT | N | - |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE |

#### 業務規則

| 規則編號 | 規則說明 |
|---------|---------|
| BR01 | 手機號碼不可重複 |
| BR02 | 會員編號建立後不可修改 |
| BR03 | 有消費紀錄的會員不可刪除 |
| BR04 | 新會員自動設為最低等級 |

---

### 4.2 會員等級管理 (F07-002)

**功能說明**: 設定會員等級與升降級規則。

#### 等級設定

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 等級代碼 | INT | Y | 數字越大等級越高 |
| 等級名稱 | NVARCHAR(50) | Y | - |
| 累積消費門檻 | DECIMAL(12,2) | Y | 達此金額升級 |
| 維持消費門檻 | DECIMAL(12,2) | N | 年度需達此金額維持 |
| 折扣比例 | DECIMAL(5,2) | N | 會員折扣 % |
| 點數倍率 | DECIMAL(3,1) | Y | 點數加乘倍率 |
| 專屬優惠 | JSON | N | 其他優惠設定 |

#### 等級範例

| 等級 | 名稱 | 累積消費門檻 | 折扣 | 點數倍率 |
|:---:|------|----------:|:---:|:-------:|
| 1 | 一般會員 | $0 | 0% | 1x |
| 2 | 銀卡會員 | $10,000 | 3% | 1.5x |
| 3 | 金卡會員 | $30,000 | 5% | 2x |
| 4 | 白金會員 | $100,000 | 8% | 3x |
| 5 | VIP會員 | $300,000 | 10% | 5x |

#### 升降級規則

| 規則類型 | 說明 |
|---------|------|
| 升級 | 累積消費達門檻立即升級 |
| 降級 | 年度消費未達維持門檻則降級 (可關閉) |
| 計算週期 | 可設定為累積制或年度制 |
| 保護期 | 新升級後N天內不降級 |

---

### 4.3 點數管理 (F07-003)

**功能說明**: 管理會員點數的累積與兌換規則。

#### 點數累積規則

```
基本公式:
獲得點數 = (消費金額 / 點數換算比例) × 會員等級倍率

範例:
消費 $1,000，換算比例 10:1，金卡會員(2倍)
獲得點數 = (1000 / 10) × 2 = 200 點
```

#### 點數設定欄位

| 設定項目 | 說明 | 預設值 |
|---------|------|--------|
| 點數換算比例 | 消費多少元得1點 | 10 |
| 點數價值 | 1點可折抵多少元 | 1 |
| 最低使用點數 | 單筆最少使用點數 | 100 |
| 單筆最高折抵 | 點數折抵上限 | 訂單金額50% |
| 點數有效期 | 點數到期天數 | 730天(2年) |
| 小數處理 | 無條件捨去/四捨五入 | 無條件捨去 |

#### 點數異動類型

| 類型代碼 | 說明 | 點數影響 |
|---------|------|:-------:|
| EARN | 消費獲得 | + |
| REDEEM | 點數折抵 | - |
| BONUS | 活動贈點 | + |
| ADJUST | 手動調整 | ± |
| EXPIRE | 點數過期 | - |
| REFUND | 退貨扣點 | - |
| TRANSFER | 點數轉移 | ± |

---

## 5. 供應商管理

### 5.1 供應商資料管理 (F06-001)

**功能說明**: 管理供應商基本資料與交易條件。

#### 輸入欄位 - 基本資訊

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 供應商編號 | VARCHAR(20) | Y | 唯一值 |
| 供應商名稱 | NVARCHAR(100) | Y | - |
| 供應商簡稱 | NVARCHAR(50) | N | - |
| 統一編號 | VARCHAR(10) | N | 台灣統編 |
| 聯絡人 | NVARCHAR(50) | Y | - |
| 電話 | VARCHAR(20) | Y | - |
| 傳真 | VARCHAR(20) | N | - |
| Email | VARCHAR(100) | N | - |
| 地址 | NVARCHAR(200) | N | - |
| 網站 | VARCHAR(200) | N | - |

#### 輸入欄位 - 交易條件

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 付款條件 | ENUM | N | 月結30/60/90天、貨到付款 |
| 幣別 | VARCHAR(3) | Y | 預設TWD |
| 稅別 | VARCHAR(10) | Y | 應稅/免稅 |
| 最低訂購金額 | DECIMAL(12,2) | N | - |
| 運費計算方式 | ENUM | N | 免運/定額/依金額/依重量 |
| 免運門檻 | DECIMAL(12,2) | N | 達此金額免運 |

#### 輸入欄位 - 銀行資訊

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 銀行名稱 | NVARCHAR(50) | N | - |
| 銀行代碼 | VARCHAR(10) | N | - |
| 分行名稱 | NVARCHAR(50) | N | - |
| 帳戶名稱 | NVARCHAR(100) | N | - |
| 帳戶號碼 | VARCHAR(20) | N | - |

---

## 6. 基礎設定

### 6.1 單位管理 (F02-002)

**功能說明**: 定義商品計量單位與換算關係。

#### 預設單位

| 單位代碼 | 單位名稱 | 說明 |
|---------|---------|------|
| PCS | 個 | 最小單位 |
| BOX | 盒 | - |
| CTN | 箱 | - |
| PKG | 包 | - |
| SET | 組 | - |
| KG | 公斤 | - |
| G | 公克 | - |
| L | 公升 | - |
| ML | 毫升 | - |

#### 單位換算設定

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品ID | INT (FK) | Y | - |
| 基本單位 | VARCHAR(10) | Y | 最小計量單位 |
| 換算單位 | VARCHAR(10) | Y | 較大單位 |
| 換算率 | DECIMAL(10,4) | Y | 1換算單位=N基本單位 |

**範例**:
| 商品 | 基本單位 | 換算單位 | 換算率 |
|------|---------|---------|--------|
| 可樂 | 瓶 | 箱 | 24 |
| 糖果 | 顆 | 包 | 50 |

---

### 6.2 付款方式管理 (F02-003)

**功能說明**: 設定系統支援的付款方式。

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 付款代碼 | VARCHAR(20) | Y | 唯一值 |
| 付款名稱 | NVARCHAR(50) | Y | - |
| 需要找零 | BOOLEAN | Y | 現金類需要 |
| 需要授權碼 | BOOLEAN | Y | 信用卡類需要 |
| 圖示 | VARCHAR(100) | N | - |
| 排序 | INT | N | POS顯示順序 |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE |

#### 預設付款方式

| 代碼 | 名稱 | 需找零 | 需授權碼 |
|------|------|:-----:|:-------:|
| CASH | 現金 | Y | N |
| CARD | 信用卡 | N | Y |
| DEBIT | 簽帳卡 | N | Y |
| LINEPAY | Line Pay | N | N |
| JKOPAY | 街口支付 | N | N |
| APPLEPAY | Apple Pay | N | N |
| TRANSFER | 轉帳 | N | N |
| VOUCHER | 禮券 | Y | N |

---

### 6.3 稅別管理 (F02-004)

**功能說明**: 設定商品適用的稅別類型。

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 稅別代碼 | VARCHAR(10) | Y | 唯一值 |
| 稅別名稱 | NVARCHAR(30) | Y | - |
| 稅率 | DECIMAL(5,2) | Y | 百分比 |
| 計算方式 | ENUM | Y | 內含/外加 |
| 狀態 | ENUM | Y | ACTIVE/INACTIVE |

#### 預設稅別

| 稅別代碼 | 名稱 | 稅率 | 計算方式 |
|---------|------|:----:|---------|
| TAX | 應稅 | 5% | 外加 |
| TAX_INC | 應稅(含稅價) | 5% | 內含 |
| ZERO | 零稅率 | 0% | - |
| FREE | 免稅 | 0% | - |

---

### 6.4 倉庫管理 (F02-005)

**功能說明**: 管理各門市或獨立倉庫的庫存儲位。

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 倉庫代碼 | VARCHAR(20) | Y | 唯一值 |
| 倉庫名稱 | NVARCHAR(100) | Y | - |
| 倉庫類型 | ENUM | Y | STORE(門市)/WAREHOUSE(倉庫) |
| 所屬門市 | INT (FK) | N | 門市倉必填 |
| 地址 | NVARCHAR(200) | N | 獨立倉庫地址 |
| 聯絡人 | NVARCHAR(50) | N | - |
| 電話 | VARCHAR(20) | N | - |
| 是否預設 | BOOLEAN | Y | 進貨預設倉庫 |
| 狀態 | ENUM | Y | ACTIVE / INACTIVE |

---

### 6.5 編號規則設定 (F02-006)

**功能說明**: 設定各類單據的自動編號規則。

#### 輸入欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 單據類型 | ENUM | Y | 唯一值 |
| 前綴 | VARCHAR(10) | Y | 固定前綴文字 |
| 日期格式 | ENUM | N | YYYYMMDD/YYYYMM/YYYY/無 |
| 流水號位數 | INT | Y | 3-10位 |
| 重置週期 | ENUM | Y | 每日/每月/每年/不重置 |

#### 編號規則範例

| 單據類型 | 前綴 | 日期格式 | 流水號位數 | 範例 |
|---------|------|---------|:--------:|------|
| 銷售單 | SO | YYYYMMDD | 4 | SO202512310001 |
| 採購單 | PO | YYYYMM | 5 | PO20251200001 |
| 進貨單 | GR | YYYYMMDD | 4 | GR202512310001 |
| 退貨單 | RT | YYYYMMDD | 4 | RT202512310001 |
| 盤點單 | IV | YYYYMMDD | 3 | IV20251231001 |
| 調撥單 | TR | YYYYMMDD | 4 | TR202512310001 |

---

## 7. 資料表設計

### 7.1 商品相關資料表

#### products (商品主檔)

```sql
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    sku VARCHAR(30) NOT NULL UNIQUE,
    barcode VARCHAR(30) UNIQUE,
    name NVARCHAR(200) NOT NULL,
    short_name NVARCHAR(50),
    category_id INT NOT NULL,
    brand NVARCHAR(50),
    description NVARCHAR(500),
    unit VARCHAR(10) NOT NULL,
    cost_price DECIMAL(12,2) NOT NULL DEFAULT 0,
    selling_price DECIMAL(12,2) NOT NULL,
    member_price DECIMAL(12,2),
    min_price DECIMAL(12,2),
    tax_type VARCHAR(10) NOT NULL DEFAULT 'TAX',
    safety_stock INT DEFAULT 0,
    max_stock INT,
    track_inventory BOOLEAN DEFAULT TRUE,
    supplier_id INT,
    image_url VARCHAR(500),
    notes TEXT,
    status ENUM('ACTIVE', 'INACTIVE', 'DISCONTINUED') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_by INT,

    FOREIGN KEY (category_id) REFERENCES categories(id),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    INDEX idx_sku (sku),
    INDEX idx_barcode (barcode),
    INDEX idx_category (category_id),
    INDEX idx_status (status)
);
```

#### product_variants (商品規格)

```sql
CREATE TABLE product_variants (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    sku VARCHAR(50) NOT NULL UNIQUE,
    barcode VARCHAR(30) UNIQUE,
    variant_options JSON NOT NULL,
    cost_price DECIMAL(12,2),
    selling_price DECIMAL(12,2),
    image_url VARCHAR(500),
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_product (product_id)
);
```

#### categories (商品分類)

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(20) NOT NULL UNIQUE,
    name NVARCHAR(50) NOT NULL,
    parent_id INT,
    level INT NOT NULL DEFAULT 1,
    path VARCHAR(200),
    sort_order INT DEFAULT 0,
    icon VARCHAR(100),
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (parent_id) REFERENCES categories(id),
    INDEX idx_parent (parent_id),
    INDEX idx_path (path)
);
```

### 7.2 客戶相關資料表

#### customers (客戶/會員)

```sql
CREATE TABLE customers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    member_no VARCHAR(20) NOT NULL UNIQUE,
    name NVARCHAR(50) NOT NULL,
    gender ENUM('M', 'F', 'OTHER'),
    birthday DATE,
    phone VARCHAR(20) NOT NULL UNIQUE,
    email VARCHAR(100),
    address NVARCHAR(200),
    level_id INT NOT NULL DEFAULT 1,
    total_spending DECIMAL(14,2) DEFAULT 0,
    total_points INT DEFAULT 0,
    available_points INT DEFAULT 0,
    join_date DATE NOT NULL,
    join_store_id INT,
    notes TEXT,
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (level_id) REFERENCES customer_levels(id),
    INDEX idx_phone (phone),
    INDEX idx_member_no (member_no)
);
```

#### customer_levels (會員等級)

```sql
CREATE TABLE customer_levels (
    id INT PRIMARY KEY AUTO_INCREMENT,
    level_code INT NOT NULL UNIQUE,
    name NVARCHAR(50) NOT NULL,
    spending_threshold DECIMAL(12,2) NOT NULL DEFAULT 0,
    maintain_threshold DECIMAL(12,2),
    discount_rate DECIMAL(5,2) DEFAULT 0,
    points_multiplier DECIMAL(3,1) DEFAULT 1.0,
    benefits JSON,
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### points_logs (點數紀錄)

```sql
CREATE TABLE points_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    type ENUM('EARN', 'REDEEM', 'BONUS', 'ADJUST', 'EXPIRE', 'REFUND') NOT NULL,
    points INT NOT NULL,
    balance INT NOT NULL,
    reference_type VARCHAR(20),
    reference_id INT,
    description NVARCHAR(200),
    expire_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,

    FOREIGN KEY (customer_id) REFERENCES customers(id),
    INDEX idx_customer (customer_id),
    INDEX idx_created (created_at)
);
```

### 7.3 供應商相關資料表

#### suppliers (供應商)

```sql
CREATE TABLE suppliers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(20) NOT NULL UNIQUE,
    name NVARCHAR(100) NOT NULL,
    short_name NVARCHAR(50),
    tax_id VARCHAR(10),
    contact_person NVARCHAR(50),
    phone VARCHAR(20),
    fax VARCHAR(20),
    email VARCHAR(100),
    address NVARCHAR(200),
    website VARCHAR(200),
    payment_terms ENUM('CASH', 'NET30', 'NET60', 'NET90') DEFAULT 'NET30',
    currency VARCHAR(3) DEFAULT 'TWD',
    tax_type VARCHAR(10) DEFAULT 'TAX',
    min_order_amount DECIMAL(12,2),
    shipping_method ENUM('FREE', 'FIXED', 'BY_AMOUNT', 'BY_WEIGHT'),
    free_shipping_threshold DECIMAL(12,2),
    bank_name NVARCHAR(50),
    bank_code VARCHAR(10),
    bank_branch NVARCHAR(50),
    account_name NVARCHAR(100),
    account_number VARCHAR(20),
    notes TEXT,
    status ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_code (code)
);
```

---

## 8. API規格

### 8.1 商品 API

#### 取得商品列表

```
GET /api/v1/products
```

**查詢參數**:
| 參數 | 類型 | 說明 |
|------|------|------|
| page | int | 頁碼，預設1 |
| per_page | int | 每頁筆數，預設20 |
| keyword | string | 關鍵字搜尋(編號/名稱) |
| category_id | int | 分類ID |
| supplier_id | int | 供應商ID |
| status | string | 狀態篩選 |
| min_price | number | 最低價格 |
| max_price | number | 最高價格 |
| sort | string | 排序欄位 |
| order | string | asc/desc |

**回應範例**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "sku": "PRD001",
      "barcode": "4710088012345",
      "name": "經典白色T-Shirt",
      "short_name": "白T-Shirt",
      "category": {
        "id": 5,
        "name": "T-Shirt",
        "path": "服飾 > 上衣 > T-Shirt"
      },
      "unit": "件",
      "cost_price": 150.00,
      "selling_price": 299.00,
      "member_price": 269.00,
      "stock_quantity": 125,
      "status": "ACTIVE"
    }
  ],
  "meta": {
    "page": 1,
    "per_page": 20,
    "total": 156,
    "total_pages": 8
  }
}
```

#### 條碼查詢商品

```
GET /api/v1/products/barcode/:barcode
```

**回應範例**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "sku": "PRD001",
    "barcode": "4710088012345",
    "name": "經典白色T-Shirt",
    "selling_price": 299.00,
    "member_price": 269.00,
    "stock_quantity": 125,
    "promotions": [
      {
        "id": 10,
        "name": "週年慶特價",
        "price": 249.00,
        "end_date": "2025-12-31"
      }
    ]
  }
}
```

#### 新增商品

```
POST /api/v1/products
```

**請求內容**:
```json
{
  "sku": "PRD002",
  "barcode": "4710088012346",
  "name": "經典黑色T-Shirt",
  "short_name": "黑T-Shirt",
  "category_id": 5,
  "unit": "件",
  "cost_price": 150.00,
  "selling_price": 299.00,
  "member_price": 269.00,
  "tax_type": "TAX",
  "safety_stock": 50,
  "track_inventory": true,
  "supplier_id": 1
}
```

#### 更新商品

```
PUT /api/v1/products/:id
```

#### 批次匯入

```
POST /api/v1/products/import
Content-Type: multipart/form-data
```

**請求參數**:
| 參數 | 類型 | 說明 |
|------|------|------|
| file | file | Excel或CSV檔案 |
| mode | string | insert(僅新增)/update(僅更新)/upsert(新增或更新) |
| skip_errors | boolean | 是否跳過錯誤資料 |

### 8.2 分類 API

#### 取得分類樹

```
GET /api/v1/categories/tree
```

**回應範例**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "code": "CAT001",
      "name": "服飾類",
      "level": 1,
      "children": [
        {
          "id": 2,
          "code": "CAT001-01",
          "name": "上衣",
          "level": 2,
          "children": [
            {
              "id": 5,
              "code": "CAT001-01-01",
              "name": "T-Shirt",
              "level": 3,
              "children": []
            }
          ]
        }
      ]
    }
  ]
}
```

### 8.3 客戶 API

#### 手機號碼查詢會員

```
GET /api/v1/customers/phone/:phone
```

#### 會員點數調整

```
POST /api/v1/customers/:id/points/adjust
```

**請求內容**:
```json
{
  "type": "BONUS",
  "points": 100,
  "description": "生日贈點",
  "expire_date": "2027-12-31"
}
```

### 8.4 供應商 API

#### 取得供應商列表

```
GET /api/v1/suppliers
```

#### 取得供應商商品價格

```
GET /api/v1/suppliers/:id/prices
```

**回應範例**:
```json
{
  "success": true,
  "data": [
    {
      "product_id": 1,
      "product_name": "經典白色T-Shirt",
      "supplier_sku": "SUP-TSH-001",
      "unit_price": 120.00,
      "min_quantity": 10,
      "effective_date": "2025-01-01",
      "expire_date": null
    }
  ]
}
```

---

**文件結束**

[返回主文件](SA_00_主文件.md) | [下一章：銷售模組](SA_02_銷售模組.md)
