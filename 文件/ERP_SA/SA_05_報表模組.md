# 零售業簡易ERP系統 - 報表模組 SA文件

**文件版本**: v1.0
**建立日期**: 2025-12-31
**模組代碼**: M06
**關聯主文件**: [SA_00_主文件.md](SA_00_主文件.md)

---

## 目錄

1. [模組概述](#1-模組概述)
2. [Dashboard儀表板](#2-dashboard儀表板)
3. [銷售報表](#3-銷售報表)
4. [庫存報表](#4-庫存報表)
5. [採購報表](#5-採購報表)
6. [客戶分析報表](#6-客戶分析報表)
7. [利潤分析報表](#7-利潤分析報表)
8. [報表功能設定](#8-報表功能設定)
9. [資料表設計](#9-資料表設計)
10. [API規格](#10-api規格)

---

## 1. 模組概述

### 1.1 模組說明

報表模組負責彙整各模組資料，提供多維度的統計分析報表，協助管理者掌握營運狀況、做出決策。包含即時Dashboard、銷售/庫存/採購報表、利潤分析等功能。

### 1.2 功能清單

| 功能代碼 | 功能名稱 | 優先順序 |
|---------|---------|:-------:|
| F08-001 | 銷售報表 | P0 |
| F08-002 | 庫存報表 | P0 |
| F08-003 | 採購報表 | P1 |
| F08-004 | 利潤分析報表 | P1 |
| F08-005 | 客戶分析報表 | P1 |
| F08-006 | Dashboard儀表板 | P0 |
| F08-007 | 報表匯出 | P0 |
| F08-008 | 自訂報表 | P2 |
| F08-009 | 排程報表 | P2 |
| F08-010 | 同期比較 | P1 |

### 1.3 報表資料來源

```
┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  銷售模組   │  │  庫存模組   │  │  採購模組   │  │ 基礎資料    │
│  • 訂單     │  │  • 庫存     │  │  • 採購單   │  │  • 商品     │
│  • 退貨     │  │  • 異動     │  │  • 入庫     │  │  • 客戶     │
│  • 付款     │  │  • 盤點     │  │  • 供應商   │  │  • 分類     │
└──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
       │                │                │                │
       └────────────────┴────────────────┴────────────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │      報表模組         │
                    │  • 資料彙整           │
                    │  • 統計計算           │
                    │  • 圖表呈現           │
                    │  • 匯出下載           │
                    └───────────────────────┘
```

---

## 2. Dashboard儀表板

### 2.1 Dashboard儀表板 (F08-006)

**功能說明**: 即時顯示關鍵營運指標，提供營運概況的快速瀏覽。

#### Dashboard配置

```
┌────────────────────────────────────────────────────────────────────────┐
│ Dashboard 營運儀表板                           2025-12-31  14:30       │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ ┌──────────┐ │
│ │ 今日銷售額     │ │ 今日交易筆數   │ │ 今日毛利       │ │ 客單價   │ │
│ │                │ │                │ │                │ │          │ │
│ │  $58,900      │ │     45 筆     │ │  $20,615      │ │  $1,309  │ │
│ │  ↑ 12% vs昨日 │ │  ↑ 8% vs昨日  │ │  毛利率 35%   │ │ ↓ 3%    │ │
│ └────────────────┘ └────────────────┘ └────────────────┘ └──────────┘ │
│                                                                        │
├───────────────────────────────────────┬────────────────────────────────┤
│ 本週銷售趨勢                          │ 熱銷商品 TOP 5                 │
│ ┌───────────────────────────────────┐ │ ┌────────────────────────────┐ │
│ │     ╭─╮                           │ │ │ 1. 白色T-Shirt    $12,500 │ │
│ │ ╭──╯  ╰──╮    ╭──╮               │ │ │ 2. 黑色長褲       $9,800  │ │
│ │ │        ╰────╯  ╰─╮    ●        │ │ │ 3. 皮帶           $7,200  │ │
│ │─┼────────────────────┼───────────│ │ │ 4. 棒球帽         $5,600  │ │
│ │ 一  二  三  四  五  六  日        │ │ │ 5. 運動鞋         $4,500  │ │
│ └───────────────────────────────────┘ │ └────────────────────────────┘ │
│                                       │                                │
├───────────────────────────────────────┼────────────────────────────────┤
│ 各門市業績                            │ 庫存警示                       │
│ ┌───────────────────────────────────┐ │ ┌────────────────────────────┐ │
│ │ 台北門市 ████████████░░░░ $35,200 │ │ │ ⚠ 3 項商品缺貨             │ │
│ │ 台中門市 ████████░░░░░░░░ $15,600 │ │ │ ⚠ 8 項商品低於安全庫存     │ │
│ │ 高雄門市 ██████░░░░░░░░░░  $8,100 │ │ │                            │ │
│ └───────────────────────────────────┘ │ │ [查看詳情]                 │ │
│                                       │ └────────────────────────────┘ │
├───────────────────────────────────────┴────────────────────────────────┤
│ 待辦事項                                                               │
│ ┌────────────────────────────────────────────────────────────────────┐ │
│ │ • 3 張採購單待審核                                                 │ │
│ │ • 2 筆退貨待處理                                                   │ │
│ │ • 1 張盤點單待審核                                                 │ │
│ └────────────────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────────────┘
```

#### KPI指標卡

| 指標 | 說明 | 計算方式 |
|------|------|---------|
| 今日銷售額 | 今日淨銷售額 | 銷售額 - 退貨額 |
| 今日交易筆數 | 今日完成訂單數 | - |
| 今日毛利 | 今日毛利金額 | 銷售額 - 成本 |
| 毛利率 | 毛利佔比 | 毛利 / 銷售額 × 100% |
| 平均客單價 | 單筆交易平均金額 | 銷售額 / 交易筆數 |
| 會員交易佔比 | 會員交易比例 | 會員交易筆數 / 總筆數 |

#### 比較基準

| 比較類型 | 說明 |
|---------|------|
| vs 昨日 | 與昨日同時段比較 |
| vs 上週 | 與上週同日比較 |
| vs 上月 | 與上月同日比較 |
| vs 去年 | 與去年同期比較 |

#### 圖表元件

| 圖表 | 類型 | 說明 |
|------|------|------|
| 銷售趨勢 | 折線圖 | 近7天/30天銷售趨勢 |
| 門市業績 | 條形圖 | 各門市營業額比較 |
| 分類佔比 | 圓餅圖 | 各商品分類銷售佔比 |
| 付款方式 | 圓餅圖 | 各付款方式佔比 |
| 時段分析 | 直條圖 | 各時段銷售分布 |

---

## 3. 銷售報表

### 3.1 銷售報表 (F08-001)

**功能說明**: 提供多維度的銷售統計分析。

#### 報表類型

| 報表名稱 | 說明 | 維度 |
|---------|------|------|
| 銷售日報表 | 每日銷售統計 | 日期 |
| 銷售月報表 | 月度銷售統計 | 月份 |
| 銷售明細表 | 訂單明細清單 | 訂單 |
| 商品銷售排行 | 熱銷商品排名 | 商品 |
| 分類銷售統計 | 各分類銷售 | 分類 |
| 門市銷售統計 | 各門市銷售 | 門市 |
| 銷售員業績 | 各銷售員業績 | 人員 |
| 時段銷售分析 | 各時段銷售 | 時段 |
| 付款方式統計 | 各付款方式佔比 | 付款方式 |
| 退貨分析 | 退貨統計 | 原因 |

#### 銷售日報表

```
═══════════════════════════════════════════════════════════════════════
                          銷售日報表
═══════════════════════════════════════════════════════════════════════
報表期間: 2025-12-01 ~ 2025-12-31
門    市: 全部門市
產出時間: 2025-12-31 18:00

───────────────────────────────────────────────────────────────────────
日期        交易筆數   銷售數量   銷售總額    退貨金額    淨銷售額   毛利率
───────────────────────────────────────────────────────────────────────
12/01           42        115    $52,300     -$1,200    $51,100    34.2%
12/02           38        102    $48,600       -$800    $47,800    33.8%
12/03           45        128    $58,900     -$1,500    $57,400    35.1%
...
12/31           45        128    $58,900     -$1,200    $57,700    35.0%
───────────────────────────────────────────────────────────────────────
合計         1,250      3,420 $1,523,600   -$35,200 $1,488,400    34.5%
日均            40        110    $49,148     -$1,135    $48,013

═══════════════════════════════════════════════════════════════════════
```

#### 商品銷售排行

```
═══════════════════════════════════════════════════════════════════════
                       商品銷售排行榜
═══════════════════════════════════════════════════════════════════════
報表期間: 2025-12-01 ~ 2025-12-31
排行依據: 銷售金額
顯示筆數: TOP 20

───────────────────────────────────────────────────────────────────────
排名  商品編號   商品名稱        分類      數量   銷售金額    佔比   累計
───────────────────────────────────────────────────────────────────────
 1   PRD001    白色T-Shirt    上衣       520   $155,480    10.4%  10.4%
 2   PRD002    黑色長褲       褲子       380   $338,200    22.7%  33.1%
 3   PRD010    運動鞋         鞋類       210   $167,790    11.3%  44.4%
 4   PRD015    皮夾           配件       125   $100,000     6.7%  51.1%
 5   PRD003    皮帶           配件       280    $84,000     5.6%  56.7%
...
───────────────────────────────────────────────────────────────────────
TOP 20 合計                          2,450 $1,250,000    84.0%
其他商品                               970   $238,400    16.0%
───────────────────────────────────────────────────────────────────────
總計                                 3,420 $1,488,400   100.0%

═══════════════════════════════════════════════════════════════════════
```

#### 時段銷售分析

| 時段 | 交易筆數 | 銷售金額 | 佔比 |
|------|-------:|--------:|-----:|
| 09:00-10:00 | 85 | $42,500 | 2.9% |
| 10:00-11:00 | 120 | $68,400 | 4.6% |
| 11:00-12:00 | 180 | $102,600 | 6.9% |
| 12:00-13:00 | 210 | $119,700 | 8.0% |
| 13:00-14:00 | 195 | $111,150 | 7.5% |
| 14:00-15:00 | 165 | $94,050 | 6.3% |
| 15:00-16:00 | 145 | $82,650 | 5.6% |
| 16:00-17:00 | 155 | $88,350 | 5.9% |
| 17:00-18:00 | 185 | $105,450 | 7.1% |
| 18:00-19:00 | 220 | $125,400 | 8.4% |
| 19:00-20:00 | 250 | $142,500 | 9.6% |
| 20:00-21:00 | 280 | $159,600 | 10.7% |
| 21:00-22:00 | 310 | $245,950 | 16.5% |

#### 查詢條件

| 條件 | 類型 | 說明 |
|------|------|------|
| 日期範圍 | 日期 | 起訖日期 |
| 門市 | 下拉 | 可多選 |
| 分類 | 下拉 | 可多選 |
| 商品 | 文字 | 編號/名稱 |
| 銷售員 | 下拉 | 可多選 |
| 會員等級 | 下拉 | 可多選 |
| 付款方式 | 下拉 | 可多選 |

---

## 4. 庫存報表

### 4.1 庫存報表 (F08-002)

**功能說明**: 提供庫存狀況的統計分析。

#### 報表類型

| 報表名稱 | 說明 |
|---------|------|
| 庫存現況表 | 各商品目前庫存 |
| 庫存異動表 | 庫存進出明細 |
| 庫存價值表 | 庫存金額統計 |
| 呆滯品分析 | 長期無異動商品 |
| 缺貨預警表 | 低於安全庫存商品 |
| 庫存週轉分析 | 庫存周轉效率 |
| 盤點差異報表 | 盤點結果分析 |

#### 庫存現況表

```
═══════════════════════════════════════════════════════════════════════
                          庫存現況表
═══════════════════════════════════════════════════════════════════════
報表日期: 2025-12-31
倉    庫: 全部倉庫

───────────────────────────────────────────────────────────────────────
商品編號  商品名稱       分類    單位   總庫存   可用   安全   成本    價值
───────────────────────────────────────────────────────────────────────
PRD001   白色T-Shirt   上衣     件      317    292     50   $150  $47,550
PRD002   黑色長褲      褲子     件       60     60     60   $450  $27,000
PRD003   皮帶          配件     條      138    138     50   $200  $27,600
PRD010   運動鞋        鞋類     雙       95     95     50   $799  $75,905
PRD015   皮夾          配件     個       52     52     30   $800  $41,600
...
───────────────────────────────────────────────────────────────────────
合計                           商品數: 156 項      總庫存價值: $2,458,600

【庫存狀態摘要】
  正常:     120 項 (76.9%)
  偏低:      18 項 (11.5%)
  警告:      12 項 (7.7%)
  缺貨:       6 項 (3.9%)

═══════════════════════════════════════════════════════════════════════
```

#### 庫存週轉分析

```
═══════════════════════════════════════════════════════════════════════
                       庫存週轉分析報表
═══════════════════════════════════════════════════════════════════════
分析期間: 2025-12-01 ~ 2025-12-31

───────────────────────────────────────────────────────────────────────
分類       平均庫存    銷貨成本    週轉率    週轉天數    等級
───────────────────────────────────────────────────────────────────────
上衣       $185,000   $156,000     0.84       35.6     ★★★★ 良好
褲子       $245,000   $185,000     0.76       39.5     ★★★  正常
配件       $125,000    $78,000     0.62       48.4     ★★★  正常
鞋類       $320,000   $145,000     0.45       66.7     ★★   需改善
───────────────────────────────────────────────────────────────────────
整體       $875,000   $564,000     0.64       46.5     ★★★  正常

週轉等級說明:
★★★★★ 優秀: 週轉天數 < 20 天
★★★★  良好: 週轉天數 20-40 天
★★★   正常: 週轉天數 40-60 天
★★    需改善: 週轉天數 60-90 天
★     警示: 週轉天數 > 90 天

═══════════════════════════════════════════════════════════════════════
```

#### 呆滯品分析

| 欄位 | 說明 |
|------|------|
| 商品編號 | - |
| 商品名稱 | - |
| 倉庫 | 所在倉庫 |
| 庫存數量 | 目前庫存 |
| 庫存金額 | 庫存價值 |
| 最後異動日 | 最後進出日期 |
| 呆滯天數 | 距今天數 |
| 建議處理 | 促銷/報廢/調撥 |

**呆滯定義**:
| 等級 | 天數 | 處理建議 |
|------|------|---------|
| 輕度 | 60-90天 | 促銷出清 |
| 中度 | 90-180天 | 降價處理 |
| 重度 | 180天以上 | 評估報廢 |

---

## 5. 採購報表

### 5.1 採購報表 (F08-003)

**功能說明**: 提供採購相關的統計分析。

#### 報表類型

| 報表名稱 | 說明 |
|---------|------|
| 採購明細表 | 採購單明細查詢 |
| 採購統計表 | 期間採購金額統計 |
| 供應商採購分析 | 各供應商採購佔比 |
| 進貨成本分析 | 商品進貨成本變化 |
| 待驗收報表 | 未完成驗收採購單 |
| 應付帳款報表 | 供應商應付款項 |
| 採購前置期分析 | 供應商交貨效率 |

#### 採購統計表

```
═══════════════════════════════════════════════════════════════════════
                         採購統計月報
═══════════════════════════════════════════════════════════════════════
報表期間: 2025-12月
供 應 商: 全部

───────────────────────────────────────────────────────────────────────
【採購摘要】
  採購單數:                 45 張
  採購項數:                186 項
  採購總數量:            5,280 件
  採購總金額:       $1,856,000 (未稅)
  稅    額:           $92,800
  含稅總額:        $1,948,800

───────────────────────────────────────────────────────────────────────
【各供應商採購】
供應商            採購單數    採購金額      佔比
───────────────────────────────────────────────────────────────────────
ABC服飾批發商         15    $685,000     36.9%  ████████████████░░░░
DEF服飾商行           12    $456,000     24.6%  ██████████░░░░░░░░░░
GHI貿易公司            8    $325,000     17.5%  ███████░░░░░░░░░░░░░
JKL配件行              6    $245,000     13.2%  █████░░░░░░░░░░░░░░░
其他                   4    $145,000      7.8%  ███░░░░░░░░░░░░░░░░░
───────────────────────────────────────────────────────────────────────
合計                  45  $1,856,000    100.0%

───────────────────────────────────────────────────────────────────────
【各分類採購】
分類          採購數量    採購金額      佔比
───────────────────────────────────────────────────────────────────────
上衣            1,850    $556,000     30.0%
褲子            1,200    $485,000     26.1%
鞋類              680    $425,000     22.9%
配件            1,550    $390,000     21.0%
───────────────────────────────────────────────────────────────────────

═══════════════════════════════════════════════════════════════════════
```

#### 供應商績效分析

| 指標 | 說明 | 計算方式 |
|------|------|---------|
| 準時交貨率 | 如期交貨比例 | 準時單數 / 總單數 |
| 驗收合格率 | 品質合格比例 | 合格數量 / 到貨數量 |
| 平均前置期 | 平均交貨天數 | 總天數 / 單數 |
| 價格穩定度 | 價格波動程度 | 價格變異係數 |

---

## 6. 客戶分析報表

### 6.1 客戶分析報表 (F08-005)

**功能說明**: 提供客戶/會員的統計分析。

#### 報表類型

| 報表名稱 | 說明 |
|---------|------|
| 會員消費排行 | VIP客戶消費排名 |
| 新會員統計 | 新加入會員分析 |
| 會員等級分布 | 各等級會員人數 |
| 會員活躍度分析 | 回購率、活躍率 |
| RFM分析 | 客戶價值分群 |
| 會員點數報表 | 點數發放與使用 |
| 流失客戶分析 | 長期未消費客戶 |

#### RFM分析

```
═══════════════════════════════════════════════════════════════════════
                         RFM客戶分析報表
═══════════════════════════════════════════════════════════════════════
分析期間: 最近365天
分析日期: 2025-12-31

【RFM指標說明】
R (Recency): 最近一次消費距今天數
F (Frequency): 分析期間消費次數
M (Monetary): 分析期間消費總額

───────────────────────────────────────────────────────────────────────
【客戶分群結果】

客戶類型         人數    佔比    平均R    平均F    平均M     策略建議
───────────────────────────────────────────────────────────────────────
重要價值客戶      520   10.4%     15      12    $35,000   維護關係
重要發展客戶      380    7.6%     30       8    $25,000   增加互動
重要保持客戶      450    9.0%     45      10    $30,000   喚醒關注
重要挽留客戶      280    5.6%    120       6    $22,000   挽回計畫
───────────────────────────────────────────────────────────────────────
一般價值客戶      850   17.0%     25       4     $8,000   培養消費
一般發展客戶      620   12.4%     40       3     $6,000   促銷刺激
一般保持客戶      580   11.6%     60       3     $5,500   維持關係
低價值客戶        320    6.4%     90       2     $3,000   低成本維護
───────────────────────────────────────────────────────────────────────
新客戶            450    9.0%     10       1     $2,500   培養習慣
流失客戶          550   11.0%    180       2     $4,000   挽回嘗試
───────────────────────────────────────────────────────────────────────
合計            5,000  100.0%

═══════════════════════════════════════════════════════════════════════
```

#### 會員等級分布

| 等級 | 人數 | 佔比 | 消費金額佔比 |
|------|-----:|-----:|-----------:|
| 一般會員 | 3,200 | 64.0% | 25.0% |
| 銀卡會員 | 1,100 | 22.0% | 28.0% |
| 金卡會員 | 480 | 9.6% | 22.0% |
| 白金會員 | 165 | 3.3% | 15.0% |
| VIP會員 | 55 | 1.1% | 10.0% |

---

## 7. 利潤分析報表

### 7.1 利潤分析報表 (F08-004)

**功能說明**: 提供利潤相關的統計分析。

#### 利潤分析報表

```
═══════════════════════════════════════════════════════════════════════
                          利潤分析報表
                    2025年12月1日 ~ 2025年12月31日
═══════════════════════════════════════════════════════════════════════

【營收摘要】
  銷售總額:                           $1,523,600
  退貨金額:                             -$35,200
  折扣金額:                             -$76,180
  ─────────────────────────────────────────────────────────────────
  淨營收:                             $1,412,220    (100.0%)

【成本結構】
  銷貨成本:                            $917,943    (65.0%)
  ─────────────────────────────────────────────────────────────────
  毛利:                                $494,277    (35.0%)

───────────────────────────────────────────────────────────────────────
【各分類利潤分析】

分類        淨銷售額      成本      毛利      毛利率    佔毛利比
─────────────────────────────────────────────────────────────────────
上衣        $423,666   $254,200   $169,466    40.0%      34.3%
褲子        $395,022   $276,515   $118,507    30.0%      24.0%
配件        $310,689   $186,413   $124,276    40.0%      25.1%
鞋類        $282,843   $200,815    $82,028    29.0%      16.6%
─────────────────────────────────────────────────────────────────────
合計      $1,412,220   $917,943   $494,277    35.0%     100.0%

───────────────────────────────────────────────────────────────────────
【各門市利潤分析】

門市        淨銷售額      成本      毛利      毛利率
─────────────────────────────────────────────────────────────────────
台北門市    $635,499   $406,719   $228,780    36.0%
台中門市    $423,666   $279,619   $144,047    34.0%
高雄門市    $353,055   $231,605   $121,450    34.4%
─────────────────────────────────────────────────────────────────────

───────────────────────────────────────────────────────────────────────
【同期比較】

指標             本期           上期         增減         增減%
─────────────────────────────────────────────────────────────────────
淨銷售額     $1,412,220    $1,285,600    +$126,620      +9.8%
銷貨成本       $917,943      $847,456     +$70,487      +8.3%
毛利           $494,277      $438,144     +$56,133     +12.8%
毛利率           35.0%         34.1%        +0.9%         -

═══════════════════════════════════════════════════════════════════════
```

#### 商品利潤排行

| 排名 | 商品 | 銷售數量 | 銷售額 | 成本 | 毛利 | 毛利率 |
|:---:|------|-------:|------:|-----:|-----:|------:|
| 1 | 白色T-Shirt | 520 | $155,480 | $78,000 | $77,480 | 49.8% |
| 2 | 黑色長褲 | 380 | $338,200 | $171,000 | $167,200 | 49.4% |
| 3 | 皮夾 | 125 | $100,000 | $52,500 | $47,500 | 47.5% |
| 4 | 皮帶 | 280 | $84,000 | $56,000 | $28,000 | 33.3% |
| 5 | 運動鞋 | 210 | $167,790 | $128,100 | $39,690 | 23.6% |

---

## 8. 報表功能設定

### 8.1 報表匯出 (F08-007)

**功能說明**: 將報表匯出為不同格式。

#### 支援格式

| 格式 | 副檔名 | 說明 |
|------|--------|------|
| Excel | .xlsx | 含格式、多工作表 |
| CSV | .csv | 純資料，可匯入其他系統 |
| PDF | .pdf | 固定格式，適合列印 |

#### 匯出選項

| 選項 | 說明 |
|------|------|
| 含標題 | 是否包含報表標題 |
| 含篩選條件 | 是否顯示查詢條件 |
| 含合計 | 是否包含彙總列 |
| 含圖表 | PDF是否包含圖表 |

### 8.2 自訂報表 (F08-008)

**功能說明**: 提供基本的自訂查詢功能。

#### 可選維度

| 維度類型 | 欄位 |
|---------|------|
| 時間 | 日期、週、月、季、年 |
| 地點 | 門市、區域 |
| 商品 | 商品、分類、品牌 |
| 人員 | 銷售員、採購員 |
| 客戶 | 客戶、會員等級 |
| 供應商 | 供應商 |

#### 可選指標

| 指標類型 | 欄位 |
|---------|------|
| 數量 | 銷售數量、採購數量、庫存數量 |
| 金額 | 銷售額、採購額、成本、毛利 |
| 筆數 | 交易筆數、訂單數 |
| 比率 | 毛利率、佔比、成長率 |

### 8.3 排程報表 (F08-009)

**功能說明**: 設定報表自動產生與寄送。

#### 設定項目

| 項目 | 說明 |
|------|------|
| 報表名稱 | 排程任務名稱 |
| 報表類型 | 選擇要排程的報表 |
| 執行頻率 | 每日/每週/每月 |
| 執行時間 | 指定時間點 |
| 報表參數 | 固定或動態參數 |
| 匯出格式 | Excel/PDF |
| 寄送對象 | Email收件人 |
| 啟用狀態 | 啟用/停用 |

#### 排程範例

| 報表名稱 | 頻率 | 時間 | 收件人 |
|---------|------|------|--------|
| 銷售日報 | 每日 | 07:00 | manager@company.com |
| 庫存週報 | 每週一 | 08:00 | warehouse@company.com |
| 利潤月報 | 每月1日 | 09:00 | ceo@company.com |

### 8.4 同期比較 (F08-010)

**功能說明**: 提供不同期間的數據比較。

#### 比較類型

| 類型 | 說明 | 範例 |
|------|------|------|
| YoY | 年增率 (Year over Year) | 2025年12月 vs 2024年12月 |
| MoM | 月增率 (Month over Month) | 12月 vs 11月 |
| WoW | 週增率 (Week over Week) | 本週 vs 上週 |
| 自訂 | 任意兩期間比較 | 指定日期範圍 |

#### 比較呈現

```
┌───────────────────────────────────────────────────────────────┐
│ 銷售同期比較                                                  │
│                                                               │
│ 本期: 2025-12-01 ~ 2025-12-31                                │
│ 比較期: 2024-12-01 ~ 2024-12-31                              │
│                                                               │
│ 指標          本期           比較期         增減       增減%  │
│ ─────────────────────────────────────────────────────────    │
│ 銷售額     $1,412,220     $1,185,600    +$226,620    +19.1%  │
│ 交易筆數       1,250          1,080         +170    +15.7%  │
│ 毛利        $494,277       $390,000    +$104,277    +26.7%  │
│ 客單價        $1,130         $1,098          +32     +2.9%  │
│ 會員佔比        72%            65%           +7%        -   │
│                                                               │
│ [📈 趨勢良好] 所有核心指標均呈正成長                          │
└───────────────────────────────────────────────────────────────┘
```

---

## 9. 資料表設計

### 9.1 報表相關資料表

#### report_schedules (報表排程)

```sql
CREATE TABLE report_schedules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name NVARCHAR(100) NOT NULL,
    report_type VARCHAR(50) NOT NULL,
    parameters JSON,
    frequency ENUM('DAILY', 'WEEKLY', 'MONTHLY') NOT NULL,
    execute_time TIME NOT NULL,
    execute_day INT,
    export_format ENUM('EXCEL', 'PDF', 'CSV') DEFAULT 'EXCEL',
    recipients JSON NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    last_run_at DATETIME,
    last_run_status ENUM('SUCCESS', 'FAILED'),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,

    INDEX idx_active (is_active)
);
```

#### report_logs (報表產生紀錄)

```sql
CREATE TABLE report_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    schedule_id INT,
    report_type VARCHAR(50) NOT NULL,
    report_name NVARCHAR(100) NOT NULL,
    parameters JSON,
    file_path VARCHAR(500),
    file_size INT,
    status ENUM('SUCCESS', 'FAILED') NOT NULL,
    error_message TEXT,
    execution_time INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,

    FOREIGN KEY (schedule_id) REFERENCES report_schedules(id),
    INDEX idx_created (created_at)
);
```

#### saved_reports (自訂報表)

```sql
CREATE TABLE saved_reports (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name NVARCHAR(100) NOT NULL,
    description NVARCHAR(500),
    report_config JSON NOT NULL,
    is_public BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_created_by (created_by)
);
```

#### dashboard_widgets (儀表板元件)

```sql
CREATE TABLE dashboard_widgets (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    widget_type VARCHAR(50) NOT NULL,
    title NVARCHAR(100),
    config JSON,
    position_x INT NOT NULL,
    position_y INT NOT NULL,
    width INT NOT NULL,
    height INT NOT NULL,
    is_visible BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user (user_id)
);
```

---

## 10. API規格

### 10.1 Dashboard API

#### 取得Dashboard資料

```
GET /api/v1/dashboard
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| store_id | int | 門市ID (空=全部) |
| date | date | 查詢日期 (預設今日) |

**回應範例**:

```json
{
  "success": true,
  "data": {
    "date": "2025-12-31",
    "kpi": {
      "sales_amount": 58900,
      "sales_amount_change": 12.5,
      "transaction_count": 45,
      "transaction_change": 8.0,
      "gross_profit": 20615,
      "gross_profit_rate": 35.0,
      "avg_order_value": 1309,
      "avg_order_change": -3.2
    },
    "sales_trend": {
      "labels": ["12/25", "12/26", "12/27", "12/28", "12/29", "12/30", "12/31"],
      "data": [45200, 52800, 48600, 55300, 62100, 53200, 58900]
    },
    "top_products": [
      {"rank": 1, "name": "白色T-Shirt", "amount": 12500},
      {"rank": 2, "name": "黑色長褲", "amount": 9800},
      {"rank": 3, "name": "皮帶", "amount": 7200}
    ],
    "store_sales": [
      {"store_id": 1, "store_name": "台北門市", "amount": 35200},
      {"store_id": 2, "store_name": "台中門市", "amount": 15600},
      {"store_id": 3, "store_name": "高雄門市", "amount": 8100}
    ],
    "inventory_alerts": {
      "out_of_stock": 3,
      "low_stock": 8
    },
    "pending_tasks": {
      "pending_po_approval": 3,
      "pending_refunds": 2,
      "pending_count_approval": 1
    }
  }
}
```

### 10.2 銷售報表 API

#### 銷售日報

```
GET /api/v1/reports/sales/daily
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| date_from | date | 起始日期 |
| date_to | date | 結束日期 |
| store_id | int | 門市ID |

#### 商品銷售排行

```
GET /api/v1/reports/sales/product-ranking
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| date_from | date | 起始日期 |
| date_to | date | 結束日期 |
| category_id | int | 分類ID |
| limit | int | 筆數限制 |
| order_by | string | 排序欄位 (amount/quantity) |

### 10.3 庫存報表 API

#### 庫存現況

```
GET /api/v1/reports/inventory/current
```

#### 庫存週轉分析

```
GET /api/v1/reports/inventory/turnover
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| date_from | date | 起始日期 |
| date_to | date | 結束日期 |
| category_id | int | 分類ID |
| warehouse_id | int | 倉庫ID |

### 10.4 利潤報表 API

#### 利潤分析

```
GET /api/v1/reports/profit/analysis
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| date_from | date | 起始日期 |
| date_to | date | 結束日期 |
| group_by | string | 分組維度 (category/store/product) |

**回應範例**:

```json
{
  "success": true,
  "data": {
    "period": {
      "from": "2025-12-01",
      "to": "2025-12-31"
    },
    "summary": {
      "gross_sales": 1523600,
      "returns": 35200,
      "discounts": 76180,
      "net_sales": 1412220,
      "cost_of_goods": 917943,
      "gross_profit": 494277,
      "gross_profit_rate": 35.0
    },
    "by_category": [
      {
        "category_id": 1,
        "category_name": "上衣",
        "net_sales": 423666,
        "cost": 254200,
        "gross_profit": 169466,
        "gross_profit_rate": 40.0,
        "profit_share": 34.3
      }
    ],
    "comparison": {
      "previous_period": {
        "from": "2025-11-01",
        "to": "2025-11-30"
      },
      "net_sales_change": 9.8,
      "gross_profit_change": 12.8,
      "gross_profit_rate_change": 0.9
    }
  }
}
```

### 10.5 報表匯出 API

#### 匯出報表

```
POST /api/v1/reports/export
```

**請求內容**:

```json
{
  "report_type": "sales_daily",
  "format": "excel",
  "parameters": {
    "date_from": "2025-12-01",
    "date_to": "2025-12-31",
    "store_id": null
  },
  "options": {
    "include_header": true,
    "include_summary": true,
    "include_chart": false
  }
}
```

**回應**:

```json
{
  "success": true,
  "data": {
    "file_url": "/downloads/reports/sales_daily_20251231.xlsx",
    "file_name": "銷售日報表_20251201-20251231.xlsx",
    "file_size": 125400,
    "expires_at": "2026-01-01T00:00:00Z"
  }
}
```

### 10.6 排程報表 API

#### 建立排程

```
POST /api/v1/report-schedules
```

**請求內容**:

```json
{
  "name": "銷售日報自動寄送",
  "report_type": "sales_daily",
  "parameters": {
    "store_id": null
  },
  "frequency": "DAILY",
  "execute_time": "07:00",
  "export_format": "EXCEL",
  "recipients": ["manager@company.com", "sales@company.com"]
}
```

---

**文件結束**

[返回主文件](SA_00_主文件.md) | [上一章：採購模組](SA_04_採購模組.md)
