# 零售業簡易ERP系統 - 庫存模組 SA文件

**文件版本**: v1.0
**建立日期**: 2025-12-31
**模組代碼**: M04
**關聯主文件**: [SA_00_主文件.md](SA_00_主文件.md)

---

## 目錄

1. [模組概述](#1-模組概述)
2. [庫存查詢](#2-庫存查詢)
3. [進貨入庫](#3-進貨入庫)
4. [出貨出庫](#4-出貨出庫)
5. [庫存調整](#5-庫存調整)
6. [庫存盤點](#6-庫存盤點)
7. [庫存調撥](#7-庫存調撥)
8. [安全庫存警示](#8-安全庫存警示)
9. [系統流程圖](#9-系統流程圖)
10. [資料表設計](#10-資料表設計)
11. [API規格](#11-api規格)

---

## 1. 模組概述

### 1.1 模組說明

庫存模組負責管理商品的庫存數量，包括即時庫存查詢、進出貨記錄、庫存調整、盤點作業、倉庫間調撥等功能，確保庫存資料的準確性與即時性。

### 1.2 功能清單

| 功能代碼 | 功能名稱 | 優先順序 |
|---------|---------|:-------:|
| F04-001 | 庫存查詢 | P0 |
| F04-002 | 進貨入庫 | P0 |
| F04-003 | 出貨出庫 | P0 |
| F04-004 | 庫存調整 | P0 |
| F04-005 | 庫存盤點 | P1 |
| F04-006 | 庫存調撥 | P1 |
| F04-007 | 安全庫存警示 | P1 |

### 1.3 模組關聯

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  採購模組   │────>│   庫存模組   │<────│  銷售模組   │
│  (進貨入庫) │     │             │     │  (銷售扣庫) │
└─────────────┘     └──────┬──────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  報表模組   │
                    │  (庫存報表) │
                    └─────────────┘
```

### 1.4 庫存異動類型總覽

| 類型代碼 | 類型名稱 | 庫存影響 | 來源 |
|---------|---------|:-------:|------|
| PURCHASE_IN | 採購入庫 | + | 採購模組 |
| SALES_OUT | 銷售出庫 | - | 銷售模組 |
| RETURN_IN | 退貨入庫 | + | 銷售模組 |
| RETURN_OUT | 退貨出庫 | - | 採購模組 |
| TRANSFER_IN | 調撥入庫 | + | 庫存模組 |
| TRANSFER_OUT | 調撥出庫 | - | 庫存模組 |
| ADJUST_IN | 調整入庫 | + | 庫存模組 |
| ADJUST_OUT | 調整出庫 | - | 庫存模組 |
| COUNT_IN | 盤盈入庫 | + | 庫存模組 |
| COUNT_OUT | 盤虧出庫 | - | 庫存模組 |

---

## 2. 庫存查詢

### 2.1 庫存查詢 (F04-001)

**功能說明**: 即時查詢各倉庫/門市的商品庫存狀況。

#### 查詢維度

| 維度 | 說明 | 使用場景 |
|------|------|---------|
| 依商品 | 查詢單一商品在各倉庫的庫存 | 確認商品庫存分布 |
| 依倉庫 | 查詢單一倉庫的所有商品庫存 | 倉庫盤點前 |
| 依分類 | 查詢特定分類商品的庫存 | 品類管理 |
| 綜合查詢 | 多條件交叉查詢 | 報表分析 |

#### 查詢條件

| 條件 | 類型 | 說明 |
|------|------|------|
| 商品編號/名稱 | 文字 | 模糊搜尋 |
| 商品條碼 | 文字 | 精確搜尋 |
| 分類 | 下拉 | 可多選 |
| 倉庫/門市 | 下拉 | 可多選 |
| 庫存狀態 | 下拉 | 正常/偏低/缺貨 |
| 供應商 | 下拉 | 單選 |
| 只顯示有庫存 | 勾選 | 隱藏零庫存 |

#### 顯示欄位

| 欄位 | 說明 |
|------|------|
| 商品編號 | - |
| 商品名稱 | - |
| 條碼 | 主條碼 |
| 分類 | 商品分類 |
| 倉庫 | 所在倉庫 |
| 現有庫存 | 實際庫存數量 |
| 可用庫存 | 現有庫存 - 已預留數量 |
| 在途庫存 | 已訂購未入庫數量 |
| 安全庫存 | 設定的安全水位 |
| 庫存狀態 | 正常/偏低/缺貨 |
| 成本金額 | 庫存 × 成本價 |
| 最後異動 | 最後異動日期 |

#### 庫存狀態判斷

| 狀態 | 條件 | 顯示顏色 |
|------|------|---------|
| 正常 | 庫存 > 安全庫存 | 綠色 |
| 偏低 | 庫存 ≤ 安全庫存 且 > 安全庫存×50% | 黃色 |
| 警告 | 庫存 ≤ 安全庫存×50% 且 > 0 | 橘色 |
| 缺貨 | 庫存 = 0 | 紅色 |

#### 庫存查詢畫面

```
┌────────────────────────────────────────────────────────────────────────┐
│ 庫存查詢                                          [匯出Excel] [列印]   │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 商品: [              ] 分類: [全部 ▼] 倉庫: [全部 ▼]                  │
│ 狀態: [全部 ▼] ☐ 只顯示有庫存  ☐ 只顯示低於安全庫存        [搜尋]    │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│ 商品編號   商品名稱        倉庫      現有   可用   安全   狀態   成本  │
│ ──────────────────────────────────────────────────────────────────    │
│ PRD001    白色T-Shirt    台北門市    85     80     50    ● 正常 $12,750│
│ PRD001    白色T-Shirt    台中門市    32     32     50    ● 偏低  $4,800│
│ PRD001    白色T-Shirt    總倉庫     200    180     100   ● 正常 $30,000│
│ ──────────────────────────────────────────────────────────────────    │
│ PRD002    黑色長褲       台北門市    15     15     30    ● 警告  $6,750│
│ PRD002    黑色長褲       台中門市     0      0     30    ● 缺貨      $0│
│ PRD002    黑色長褲       總倉庫      45     35     50    ● 偏低 $20,250│
│ ──────────────────────────────────────────────────────────────────    │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│ 共 156 筆  總庫存金額: $2,458,600                     < 1 2 3 4 5 >    │
└────────────────────────────────────────────────────────────────────────┘
```

#### 庫存卡 (單一商品詳情)

```
┌────────────────────────────────────────────────────────────────────────┐
│ 庫存卡 - PRD001 白色T-Shirt                                     [X]   │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ ┌─ 商品資訊 ───────────────────────────────────────────────────────┐  │
│ │ 商品編號: PRD001          條碼: 4710088012345                     │  │
│ │ 商品名稱: 白色T-Shirt     分類: 服飾 > 上衣 > T-Shirt            │  │
│ │ 成本價: $150              售價: $299                              │  │
│ └───────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│ ┌─ 各倉庫庫存 ─────────────────────────────────────────────────────┐  │
│ │ 倉庫          現有庫存   可用庫存   安全庫存   在途庫存   狀態    │  │
│ │ ───────────────────────────────────────────────────────────────  │  │
│ │ 台北門市          85         80         50          0    ● 正常  │  │
│ │ 台中門市          32         32         50         20    ● 偏低  │  │
│ │ 總倉庫           200        180        100          0    ● 正常  │  │
│ │ ───────────────────────────────────────────────────────────────  │  │
│ │ 合計             317        292        200         20            │  │
│ └───────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│ ┌─ 最近異動紀錄 ───────────────────────────────────────────────────┐  │
│ │ 日期          類型        倉庫      數量    結存    單據編號      │  │
│ │ ───────────────────────────────────────────────────────────────  │  │
│ │ 12/31 14:30  銷售出庫   台北門市    -2      85    SO202512310001 │  │
│ │ 12/31 10:15  採購入庫   總倉庫     +50     200    GR202512310001 │  │
│ │ 12/30 16:45  調撥出庫   總倉庫     -20     150    TR202512300001 │  │
│ │ 12/30 16:45  調撥入庫   台北門市   +20      87    TR202512300001 │  │
│ │                                      [查看更多異動紀錄...]        │  │
│ └───────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│              [調整庫存]  [調撥]  [查看完整紀錄]  [關閉]                │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 進貨入庫

### 3.1 進貨入庫 (F04-002)

**功能說明**: 記錄商品進貨入庫，更新庫存數量。

#### 入庫類型

| 類型代碼 | 類型名稱 | 說明 | 庫存影響 | 成本影響 |
|---------|---------|------|:-------:|:-------:|
| PURCHASE_IN | 採購入庫 | 依採購單進貨 | + | 更新成本 |
| RETURN_IN | 退貨入庫 | 客戶退貨 | + | - |
| TRANSFER_IN | 調撥入庫 | 倉庫間調撥 | + | - |
| COUNT_IN | 盤盈入庫 | 盤點盈餘 | + | - |
| OTHER_IN | 其他入庫 | 贈品、樣品等 | + | - |

#### 入庫單欄位

**表頭欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 入庫單號 | VARCHAR(30) | Y | 自動產生 |
| 入庫類型 | ENUM | Y | 見入庫類型表 |
| 入庫日期 | DATE | Y | 預設今日 |
| 入庫倉庫 | INT (FK) | Y | 目標倉庫 |
| 來源單號 | VARCHAR(30) | N | 採購單號/調撥單號 |
| 供應商 | INT (FK) | N | 採購入庫必填 |
| 經辦人 | INT (FK) | Y | 操作人員 |
| 備註 | TEXT | N | - |

**明細欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品 | INT (FK) | Y | - |
| 規格 | INT (FK) | N | 有規格商品 |
| 入庫數量 | INT | Y | - |
| 單位 | VARCHAR(10) | Y | - |
| 單位成本 | DECIMAL(12,2) | N | 採購入庫填寫 |
| 批號 | VARCHAR(50) | N | - |
| 有效日期 | DATE | N | - |
| 備註 | NVARCHAR(200) | N | - |

#### 入庫作業畫面

```
┌────────────────────────────────────────────────────────────────────────┐
│ 進貨入庫作業                                        [儲存] [取消]      │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 入庫單號: [GR202512310001] (自動)   入庫日期: [2025-12-31]            │
│ 入庫類型: [採購入庫 ▼]              入庫倉庫: [總倉庫 ▼]              │
│ 來源單號: [PO202512310001  ] [查詢] 供應商: [ABC服飾批發商 ▼]         │
│ 備    註: [                                                        ]  │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│ ┌─ 入庫商品明細 ──────────────────────────────────────────────────┐   │
│ │ [新增商品] [從採購單匯入]                                        │   │
│ │                                                                  │   │
│ │ #  商品編號   商品名稱      採購數 已入庫  本次入庫  單位成本     │   │
│ │ ─────────────────────────────────────────────────────────────── │   │
│ │ 1  PRD001    白色T-Shirt    100     50    [  50  ]   $150      │   │
│ │ 2  PRD002    黑色長褲        50      0    [  50  ]   $450      │   │
│ │ 3  PRD003    皮帶            30     30    [   0  ]   $200      │   │
│ │                                                                  │   │
│ │ ─────────────────────────────────────────────────────────────── │   │
│ │ 合計入庫數量: 100 件        合計金額: $30,000                    │   │
│ └──────────────────────────────────────────────────────────────────┘   │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

#### 業務規則

| 規則編號 | 規則說明 |
|---------|---------|
| BR01 | 採購入庫需關聯有效採購單 |
| BR02 | 入庫數量不可超過採購單未入庫數量 |
| BR03 | 入庫完成後更新商品移動平均成本 |
| BR04 | 產生庫存異動記錄 |
| BR05 | 更新採購單狀態 (部分入庫/已完成) |

#### 成本計算 (移動平均法)

```
新平均成本 = (原庫存金額 + 本次入庫金額) / (原庫存數量 + 本次入庫數量)

範例:
原庫存: 100件 × $150 = $15,000
本次入庫: 50件 × $160 = $8,000
新平均成本: ($15,000 + $8,000) / (100 + 50) = $153.33
```

---

## 4. 出貨出庫

### 4.1 出貨出庫 (F04-003)

**功能說明**: 記錄商品出庫，扣減庫存數量。

#### 出庫類型

| 類型代碼 | 類型名稱 | 說明 | 庫存影響 |
|---------|---------|------|:-------:|
| SALES_OUT | 銷售出庫 | POS銷售自動扣庫 | - |
| RETURN_OUT | 退貨出庫 | 退還供應商 | - |
| TRANSFER_OUT | 調撥出庫 | 倉庫間調撥 | - |
| COUNT_OUT | 盤虧出庫 | 盤點短缺 | - |
| SCRAP_OUT | 報廢出庫 | 商品報廢 | - |
| OTHER_OUT | 其他出庫 | 樣品、贈送等 | - |

#### 出庫單欄位

**表頭欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 出庫單號 | VARCHAR(30) | Y | 自動產生 |
| 出庫類型 | ENUM | Y | 見出庫類型表 |
| 出庫日期 | DATE | Y | 預設今日 |
| 出庫倉庫 | INT (FK) | Y | 來源倉庫 |
| 關聯單號 | VARCHAR(30) | N | 銷售單/調撥單 |
| 經辦人 | INT (FK) | Y | 操作人員 |
| 備註 | TEXT | N | - |

#### 業務規則

| 規則編號 | 規則說明 |
|---------|---------|
| BR01 | 出庫數量不可超過可用庫存 |
| BR02 | 銷售出庫由POS系統自動產生 |
| BR03 | 報廢出庫需主管核准 |
| BR04 | 產生庫存異動記錄 |
| BR05 | 記錄出庫成本 (用於毛利計算) |

---

## 5. 庫存調整

### 5.1 庫存調整 (F04-004)

**功能說明**: 手動調整庫存數量，處理盤點差異或特殊狀況。

#### 調整原因

| 原因碼 | 說明 | 需核准 |
|--------|------|:-----:|
| DAMAGE | 損壞報廢 | Y |
| EXPIRE | 過期報廢 | Y |
| LOST | 遺失 | Y |
| FOUND | 尋獲 | N |
| ERROR | 資料錯誤更正 | Y |
| GIFT | 贈送 | Y |
| SAMPLE | 樣品 | N |
| OTHER | 其他原因 | Y |

#### 調整單欄位

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 調整單號 | VARCHAR(30) | Y | 自動產生 |
| 調整日期 | DATE | Y | 預設今日 |
| 倉庫 | INT (FK) | Y | - |
| 商品 | INT (FK) | Y | - |
| 規格 | INT (FK) | N | - |
| 調整前數量 | INT | Y | 系統帶出 |
| 調整後數量 | INT | Y | 手動輸入 |
| 調整數量 | INT | Y | 自動計算差異 |
| 調整原因 | ENUM | Y | - |
| 說明 | TEXT | Y | 必須說明原因 |
| 核准人 | INT (FK) | N | 需核准時填寫 |

#### 調整作業畫面

```
┌────────────────────────────────────────────────────────────────────────┐
│ 庫存調整                                           [儲存] [取消]       │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 調整單號: [ADJ202512310001] (自動)   調整日期: [2025-12-31]           │
│ 調整倉庫: [台北門市 ▼]                                                 │
│                                                                        │
│ ┌─ 調整商品 ──────────────────────────────────────────────────────┐   │
│ │                                                                  │   │
│ │ 商品搜尋: [PRD001           ] [查詢]                            │   │
│ │                                                                  │   │
│ │ 商品編號: PRD001                                                 │   │
│ │ 商品名稱: 白色T-Shirt                                            │   │
│ │ 目前庫存: 85 件                                                  │   │
│ │                                                                  │   │
│ │ 調整後數量: [     83     ] 件                                   │   │
│ │ 調整數量:   -2 件 (減少)                                        │   │
│ │                                                                  │   │
│ └──────────────────────────────────────────────────────────────────┘   │
│                                                                        │
│ 調整原因: [損壞報廢 ▼]                                                 │
│                                                                        │
│ 說    明: [商品有汙漬及破損，無法銷售                              ]  │
│                                                                        │
│ ⚠ 此調整需要主管核准                                                  │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

#### 業務規則

| 規則編號 | 規則說明 |
|---------|---------|
| BR01 | 調整說明為必填欄位 |
| BR02 | 報廢類調整需主管核准 |
| BR03 | 調整數量超過設定上限需主管核准 |
| BR04 | 產生調整入庫或調整出庫記錄 |
| BR05 | 調整後數量不可為負數 |

---

## 6. 庫存盤點

### 6.1 庫存盤點 (F04-005)

**功能說明**: 執行定期或不定期的庫存盤點作業。

#### 盤點類型

| 類型 | 說明 | 使用場景 |
|------|------|---------|
| 全盤 | 盤點倉庫全部商品 | 年度盤點 |
| 分類盤點 | 盤點特定分類商品 | 分類管理 |
| 抽盤 | 隨機抽樣盤點 | 日常檢核 |
| 循環盤點 | 依排程盤點不同區域 | 持續性管理 |

#### 盤點狀態

| 狀態代碼 | 狀態名稱 | 說明 |
|---------|---------|------|
| DRAFT | 草稿 | 可編輯盤點範圍 |
| IN_PROGRESS | 盤點中 | 執行盤點作業 |
| PENDING_REVIEW | 待審核 | 等待主管審核差異 |
| APPROVED | 已核准 | 審核通過 |
| COMPLETED | 已完成 | 庫存已調整 |
| CANCELLED | 已取消 | 盤點取消 |

#### 盤點單欄位

**表頭欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 盤點單號 | VARCHAR(30) | Y | 自動產生 |
| 盤點類型 | ENUM | Y | 全盤/分類/抽盤/循環 |
| 盤點日期 | DATE | Y | - |
| 盤點倉庫 | INT (FK) | Y | - |
| 盤點範圍 | JSON | N | 分類/區域設定 |
| 凍結庫存 | BOOLEAN | Y | 是否凍結異動 |
| 負責人 | INT (FK) | Y | - |
| 狀態 | ENUM | Y | - |

**明細欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品 | INT (FK) | Y | - |
| 系統庫存 | INT | Y | 盤點時的帳面庫存 |
| 實盤數量 | INT | N | 實際盤點數量 |
| 差異數量 | INT | - | 自動計算 |
| 差異原因 | ENUM | N | 有差異時填寫 |
| 盤點人員 | INT (FK) | N | - |
| 盤點時間 | DATETIME | N | - |
| 備註 | NVARCHAR(200) | N | - |

#### 盤點流程

```
[開始]
   │
   ▼
┌──────────────────┐
│ 1. 建立盤點單    │
│ • 選擇盤點倉庫   │
│ • 選擇盤點範圍   │
│ • 設定盤點日期   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐     ┌──────────────────┐
│ 2. 凍結庫存?     │──是─>│ 暫停該範圍       │
│    (可選)        │     │ 庫存異動         │
└────────┬─────────┘     └────────┬─────────┘
         │否                      │
         │<───────────────────────┘
         ▼
┌──────────────────┐
│ 3. 產生盤點清冊  │
│ • 列出待盤商品   │
│ • 可列印清冊     │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 4. 執行實地盤點  │
│ • 逐項清點數量   │
│ • 輸入實盤數量   │
│ • 可用PDA掃描    │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 5. 產生差異報表  │
│ • 系統量vs實盤量 │
│ • 標示差異項目   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 6. 有差異?       │──否──> [直接完成]
└────────┬─────────┘
         │是
         ▼
┌──────────────────┐
│ 7. 差異原因填寫  │
│ • 選擇原因類型   │
│ • 填寫說明       │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 8. 主管審核      │
└────────┬─────────┘
         │
    ┌────┴────┐
    ▼         ▼
 [核准]    [退回]
    │         │
    │         ▼
    │   ┌──────────────────┐
    │   │ 重新盤點或修正   │
    │   └────────┬─────────┘
    │            │
    │<───────────┘
    ▼
┌──────────────────┐
│ 9. 執行庫存調整  │
│ • 盤盈入庫       │
│ • 盤虧出庫       │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 10. 解除凍結     │
│    (如有凍結)    │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 11. 盤點完成     │
│ • 產生盤點報告   │
└────────┬─────────┘
         │
         ▼
[結束]
```

#### 盤點作業畫面

```
┌────────────────────────────────────────────────────────────────────────┐
│ 庫存盤點 - IV20251231001                           [儲存] [完成盤點]   │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 盤點單號: IV20251231001          狀態: ● 盤點中                       │
│ 盤點倉庫: 台北門市               盤點日期: 2025-12-31                 │
│ 盤點類型: 全盤                   負責人: 王小明                       │
│ 凍結庫存: 是 🔒                                                        │
│                                                                        │
│ 進度: ████████████░░░░░░░░ 60% (180/300 品項)                         │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│ [全部] [未盤點] [有差異] [已盤點]          搜尋: [           ] [🔍]    │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 商品編號   商品名稱         系統庫存  實盤數量  差異   狀態            │
│ ──────────────────────────────────────────────────────────────────    │
│ PRD001    白色T-Shirt          85    [  83  ]   -2   ⚠ 盤虧          │
│ PRD002    黑色長褲             15    [  15  ]    0   ✓ 相符          │
│ PRD003    皮帶                 28    [  30  ]   +2   ⚠ 盤盈          │
│ PRD004    棒球帽               42    [     ]    -   ○ 未盤點         │
│ PRD005    運動鞋               18    [     ]    -   ○ 未盤點         │
│                                                                        │
│ ──────────────────────────────────────────────────────────────────    │
│ 已盤點: 180 項  相符: 165 項  差異: 15 項  未盤: 120 項               │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

#### 盤點差異報表

```
═══════════════════════════════════════════════════════════════════════
                        庫存盤點差異報表
═══════════════════════════════════════════════════════════════════════
盤點單號: IV20251231001              盤點日期: 2025-12-31
盤點倉庫: 台北門市                   盤點類型: 全盤
負 責 人: 王小明                     審 核 人: 李經理

───────────────────────────────────────────────────────────────────────
【盤點摘要】
  盤點品項數:                        300 項
  相符品項:                          285 項 (95.0%)
  差異品項:                           15 項 (5.0%)
  ─────────────────────────────────────────────────────────────────
  盤盈項目:                            5 項    金額: +$3,250
  盤虧項目:                           10 項    金額: -$8,500
  ─────────────────────────────────────────────────────────────────
  淨差異:                                      金額: -$5,250

───────────────────────────────────────────────────────────────────────
【差異明細】

  盤虧項目:
  商品編號    商品名稱        系統  實盤  差異    單價     金額   原因
  ─────────────────────────────────────────────────────────────────
  PRD001     白色T-Shirt      85    83    -2    $150    -$300   遺失
  PRD010     休閒襪 (黑)     120   115    -5     $50    -$250   破損
  PRD015     皮夾             25    22    -3    $800  -$2,400   遺失
  ...

  盤盈項目:
  商品編號    商品名稱        系統  實盤  差異    單價     金額   原因
  ─────────────────────────────────────────────────────────────────
  PRD003     皮帶             28    30    +2    $200    +$400   入庫漏登
  PRD025     手錶             10    12    +2  $1,200  +$2,400   退貨漏登
  ...

───────────────────────────────────────────────────────────────────────
盤點人員簽名: ________________    審核主管簽名: ________________

列印日期: 2025-12-31 18:00
═══════════════════════════════════════════════════════════════════════
```

---

## 7. 庫存調撥

### 7.1 庫存調撥 (F04-006)

**功能說明**: 處理倉庫/門市之間的庫存移轉。

#### 調撥狀態

| 狀態代碼 | 狀態名稱 | 說明 |
|---------|---------|------|
| DRAFT | 草稿 | 可編輯 |
| PENDING | 待審核 | 等待審核 |
| APPROVED | 已核准 | 審核通過 |
| SHIPPING | 出庫中 | 來源倉庫已出庫 |
| IN_TRANSIT | 在途中 | 運送中 |
| RECEIVED | 已入庫 | 目的倉庫已入庫 |
| COMPLETED | 已完成 | 調撥完成 |
| CANCELLED | 已取消 | - |

#### 調撥單欄位

**表頭欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 調撥單號 | VARCHAR(30) | Y | 自動產生 |
| 來源倉庫 | INT (FK) | Y | - |
| 目的倉庫 | INT (FK) | Y | - |
| 申請日期 | DATE | Y | - |
| 預計出庫日 | DATE | Y | - |
| 預計入庫日 | DATE | N | - |
| 申請人 | INT (FK) | Y | - |
| 調撥原因 | TEXT | N | - |
| 狀態 | ENUM | Y | - |

**明細欄位**:

| 欄位名稱 | 資料型態 | 必填 | 說明 |
|---------|---------|:----:|------|
| 商品 | INT (FK) | Y | - |
| 規格 | INT (FK) | N | - |
| 調撥數量 | INT | Y | - |
| 實際出庫數量 | INT | N | - |
| 實際入庫數量 | INT | N | - |
| 備註 | NVARCHAR(200) | N | - |

#### 調撥流程

```
[開始]
   │
   ▼
┌──────────────────┐
│ 1. 建立調撥單    │
│ • 指定來源倉庫   │
│ • 指定目的倉庫   │
│ • 選擇調撥商品   │
│ • 輸入調撥數量   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐     ┌──────────────────┐
│ 2. 需要審核?     │──是─>│ 送交主管審核     │
└────────┬─────────┘     └────────┬─────────┘
         │否                      │
         │              ┌─────────┴─────────┐
         │              ▼                   ▼
         │          [核准]              [退回]
         │              │                   │
         │              │                   ▼
         │              │         ┌──────────────────┐
         │              │         │ 修改調撥單       │
         │              │         └────────┬─────────┘
         │              │                  │
         │<─────────────┴──────────────────┘
         ▼
┌──────────────────┐
│ 3. 來源倉庫出庫  │
│ • 確認出庫數量   │
│ • 產生出庫單     │
│ • 扣減來源庫存   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 4. 在途中        │
│ • 商品運送       │
│ • 追蹤物流       │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ 5. 目的倉庫入庫  │
│ • 確認入庫數量   │
│ • 產生入庫單     │
│ • 增加目的庫存   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐     ┌──────────────────┐
│ 6. 數量相符?     │──否─>│ 處理差異         │
└────────┬─────────┘     │ • 記錄短溢收     │
         │是              │ • 調查原因       │
         │               └────────┬─────────┘
         │                        │
         ▼<───────────────────────┘
┌──────────────────┐
│ 7. 調撥完成      │
└────────┬─────────┘
         │
         ▼
[結束]
```

#### 調撥作業畫面

```
┌────────────────────────────────────────────────────────────────────────┐
│ 庫存調撥                                           [儲存] [送審]       │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 調撥單號: [TR202512310001] (自動)    狀態: ● 草稿                     │
│                                                                        │
│ 來源倉庫: [總倉庫 ▼]     可用庫存量: 依商品顯示                       │
│ 目的倉庫: [台北門市 ▼]   目前庫存量: 依商品顯示                       │
│                                                                        │
│ 預計出庫日: [2025-12-31]  預計入庫日: [2025-12-31]                    │
│ 調撥原因: [補充門市庫存                                            ]  │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│ ┌─ 調撥商品明細 ──────────────────────────────────────────────────┐   │
│ │ [新增商品]                                                       │   │
│ │                                                                  │   │
│ │ #  商品編號   商品名稱        來源庫存  目的庫存  調撥數量       │   │
│ │ ─────────────────────────────────────────────────────────────── │   │
│ │ 1  PRD001    白色T-Shirt       200        32    [   30   ]      │   │
│ │ 2  PRD002    黑色長褲           45        15    [   20   ]      │   │
│ │ 3  PRD003    皮帶               80        28    [   10   ]      │   │
│ │                                                     [刪除]      │   │
│ │ ─────────────────────────────────────────────────────────────── │   │
│ │ 合計調撥數量: 60 件                                              │   │
│ └──────────────────────────────────────────────────────────────────┘   │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 安全庫存警示

### 8.1 安全庫存警示 (F04-007)

**功能說明**: 監控庫存水位，低於安全庫存時發出警示。

#### 警示等級

| 警示等級 | 條件 | 顯示顏色 | 圖示 |
|---------|------|---------|------|
| 正常 | 庫存 > 安全庫存 | 綠色 | ● |
| 注意 | 庫存 ≤ 安全庫存 | 黃色 | ⚠ |
| 警告 | 庫存 ≤ 安全庫存 × 50% | 橘色 | ⚠ |
| 危急 | 庫存 ≤ 安全庫存 × 25% | 紅色 | 🔴 |
| 缺貨 | 庫存 = 0 | 紅色 | ❌ |

#### 警示通知方式

| 通知方式 | 說明 | 設定 |
|---------|------|------|
| Dashboard | 首頁即時顯示警示商品 | 預設開啟 |
| 系統通知 | 系統內通知訊息 | 可設定 |
| Email | 發送Email通知 | 可設定收件人 |
| 定時報表 | 每日/每週低庫存報表 | 可設定排程 |

#### 警示清單畫面

```
┌────────────────────────────────────────────────────────────────────────┐
│ 庫存警示清單                                         [匯出] [設定]     │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│ 篩選: [全部倉庫 ▼] [全部分類 ▼] [全部等級 ▼]                         │
│                                                                        │
│ ⚠ 共 23 項商品需要關注                                                │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│ 等級  商品編號  商品名稱       倉庫     現有  安全  缺口   操作        │
│ ──────────────────────────────────────────────────────────────────    │
│ ❌   PRD002   黑色長褲       台中門市    0    30   -30   [建議採購]   │
│ 🔴   PRD015   皮夾          台北門市    5    30   -25   [建議調撥]   │
│ ⚠    PRD001   白色T-Shirt   台中門市   32    50   -18   [建議調撥]   │
│ ⚠    PRD008   休閒鞋        總倉庫     45    50    -5   [建議採購]   │
│ ⚠    PRD010   棒球帽        台北門市   22    30    -8   [建議調撥]   │
│                                                                        │
│ ──────────────────────────────────────────────────────────────────    │
│ 缺貨: 3 項 | 危急: 5 項 | 警告: 8 項 | 注意: 7 項                      │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

#### 採購建議功能

| 功能 | 說明 |
|------|------|
| 建議採購量 | 安全庫存 - 現有庫存 - 在途庫存 |
| 快速建立採購單 | 從警示清單直接建立採購單 |
| 建議調撥 | 從有庫存的倉庫調撥 |

---

## 9. 系統流程圖

### 9.1 庫存異動總流程

```
                    ┌─────────────────┐
                    │    庫存異動     │
                    └────────┬────────┘
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
         ▼                   ▼                   ▼
    ┌─────────┐        ┌─────────┐        ┌─────────┐
    │  入庫   │        │  出庫   │        │  調整   │
    └────┬────┘        └────┬────┘        └────┬────┘
         │                   │                   │
    ┌────┴────┐        ┌────┴────┐        ┌────┴────┐
    │採購入庫 │        │銷售出庫 │        │盤點調整 │
    │調撥入庫 │        │調撥出庫 │        │損耗調整 │
    │退貨入庫 │        │退貨出庫 │        │人工調整 │
    │盤盈入庫 │        │報廢出庫 │        └────┬────┘
    └────┬────┘        └────┬────┘              │
         │                   │                   │
         └───────────────────┴───────────────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  庫存異動記錄   │
                    │  • 異動類型     │
                    │  • 異動數量     │
                    │  • 異動前庫存   │
                    │  • 異動後庫存   │
                    │  • 關聯單據     │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  更新庫存數量   │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  檢查安全庫存   │
                    │  發出警示通知   │
                    └─────────────────┘
```

---

## 10. 資料表設計

### 10.1 庫存相關資料表

#### inventory (庫存)

```sql
CREATE TABLE inventory (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    variant_id INT,
    warehouse_id INT NOT NULL,
    quantity INT NOT NULL DEFAULT 0,
    reserved_quantity INT NOT NULL DEFAULT 0,
    available_quantity INT GENERATED ALWAYS AS (quantity - reserved_quantity) STORED,
    last_count_date DATE,
    last_movement_date DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    UNIQUE KEY uk_product_warehouse (product_id, variant_id, warehouse_id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    INDEX idx_product (product_id),
    INDEX idx_warehouse (warehouse_id),
    INDEX idx_quantity (quantity)
);
```

#### inventory_movements (庫存異動)

```sql
CREATE TABLE inventory_movements (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    variant_id INT,
    warehouse_id INT NOT NULL,
    movement_type ENUM(
        'PURCHASE_IN', 'SALES_OUT', 'RETURN_IN', 'RETURN_OUT',
        'TRANSFER_IN', 'TRANSFER_OUT', 'ADJUST_IN', 'ADJUST_OUT',
        'COUNT_IN', 'COUNT_OUT', 'SCRAP_OUT', 'OTHER_IN', 'OTHER_OUT'
    ) NOT NULL,
    quantity INT NOT NULL,
    before_quantity INT NOT NULL,
    after_quantity INT NOT NULL,
    unit_cost DECIMAL(12,2),
    reference_type VARCHAR(20),
    reference_id INT,
    reference_no VARCHAR(30),
    notes NVARCHAR(200),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,

    FOREIGN KEY (product_id) REFERENCES products(id),
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    INDEX idx_product_warehouse (product_id, warehouse_id),
    INDEX idx_movement_type (movement_type),
    INDEX idx_created (created_at),
    INDEX idx_reference (reference_type, reference_id)
);
```

#### goods_receipts (入庫單)

```sql
CREATE TABLE goods_receipts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    receipt_no VARCHAR(30) NOT NULL UNIQUE,
    receipt_type ENUM('PURCHASE_IN', 'RETURN_IN', 'TRANSFER_IN', 'COUNT_IN', 'OTHER_IN') NOT NULL,
    receipt_date DATE NOT NULL,
    warehouse_id INT NOT NULL,
    source_type VARCHAR(20),
    source_id INT,
    source_no VARCHAR(30),
    supplier_id INT,
    total_quantity INT DEFAULT 0,
    total_amount DECIMAL(14,2) DEFAULT 0,
    notes TEXT,
    status ENUM('DRAFT', 'COMPLETED', 'CANCELLED') DEFAULT 'DRAFT',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,
    completed_at DATETIME,

    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    INDEX idx_receipt_no (receipt_no),
    INDEX idx_receipt_date (receipt_date)
);
```

#### goods_receipt_items (入庫單明細)

```sql
CREATE TABLE goods_receipt_items (
    id INT PRIMARY KEY AUTO_INCREMENT,
    receipt_id INT NOT NULL,
    product_id INT NOT NULL,
    variant_id INT,
    quantity INT NOT NULL,
    unit VARCHAR(10) NOT NULL,
    unit_cost DECIMAL(12,2),
    amount DECIMAL(12,2),
    batch_no VARCHAR(50),
    expiry_date DATE,
    notes NVARCHAR(200),

    FOREIGN KEY (receipt_id) REFERENCES goods_receipts(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_receipt (receipt_id)
);
```

#### goods_issues (出庫單)

```sql
CREATE TABLE goods_issues (
    id INT PRIMARY KEY AUTO_INCREMENT,
    issue_no VARCHAR(30) NOT NULL UNIQUE,
    issue_type ENUM('SALES_OUT', 'RETURN_OUT', 'TRANSFER_OUT', 'COUNT_OUT', 'SCRAP_OUT', 'OTHER_OUT') NOT NULL,
    issue_date DATE NOT NULL,
    warehouse_id INT NOT NULL,
    reference_type VARCHAR(20),
    reference_id INT,
    reference_no VARCHAR(30),
    total_quantity INT DEFAULT 0,
    total_cost DECIMAL(14,2) DEFAULT 0,
    notes TEXT,
    status ENUM('DRAFT', 'COMPLETED', 'CANCELLED') DEFAULT 'DRAFT',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,

    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    INDEX idx_issue_no (issue_no)
);
```

#### stock_counts (盤點單)

```sql
CREATE TABLE stock_counts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    count_no VARCHAR(30) NOT NULL UNIQUE,
    count_type ENUM('FULL', 'CATEGORY', 'SPOT', 'CYCLE') NOT NULL,
    warehouse_id INT NOT NULL,
    count_date DATE NOT NULL,
    count_scope JSON,
    freeze_inventory BOOLEAN DEFAULT FALSE,
    total_items INT DEFAULT 0,
    counted_items INT DEFAULT 0,
    variance_items INT DEFAULT 0,
    variance_amount DECIMAL(14,2) DEFAULT 0,
    status ENUM('DRAFT', 'IN_PROGRESS', 'PENDING_REVIEW', 'APPROVED', 'COMPLETED', 'CANCELLED') DEFAULT 'DRAFT',
    assigned_to INT,
    approved_by INT,
    approved_at DATETIME,
    completed_at DATETIME,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INT,

    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    INDEX idx_count_no (count_no),
    INDEX idx_status (status)
);
```

#### stock_count_items (盤點單明細)

```sql
CREATE TABLE stock_count_items (
    id INT PRIMARY KEY AUTO_INCREMENT,
    count_id INT NOT NULL,
    product_id INT NOT NULL,
    variant_id INT,
    system_quantity INT NOT NULL,
    counted_quantity INT,
    variance_quantity INT GENERATED ALWAYS AS (COALESCE(counted_quantity, 0) - system_quantity) STORED,
    unit_cost DECIMAL(12,2),
    variance_amount DECIMAL(12,2),
    variance_reason ENUM('DAMAGE', 'EXPIRE', 'LOST', 'FOUND', 'ERROR', 'OTHER'),
    counted_by INT,
    counted_at DATETIME,
    notes NVARCHAR(200),

    FOREIGN KEY (count_id) REFERENCES stock_counts(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_count (count_id)
);
```

#### stock_transfers (調撥單)

```sql
CREATE TABLE stock_transfers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    transfer_no VARCHAR(30) NOT NULL UNIQUE,
    from_warehouse_id INT NOT NULL,
    to_warehouse_id INT NOT NULL,
    request_date DATE NOT NULL,
    expected_ship_date DATE,
    expected_arrival_date DATE,
    actual_ship_date DATE,
    actual_arrival_date DATE,
    total_quantity INT DEFAULT 0,
    shipped_quantity INT DEFAULT 0,
    received_quantity INT DEFAULT 0,
    transfer_reason TEXT,
    status ENUM('DRAFT', 'PENDING', 'APPROVED', 'SHIPPING', 'IN_TRANSIT', 'RECEIVED', 'COMPLETED', 'CANCELLED') DEFAULT 'DRAFT',
    requested_by INT,
    approved_by INT,
    approved_at DATETIME,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (from_warehouse_id) REFERENCES warehouses(id),
    FOREIGN KEY (to_warehouse_id) REFERENCES warehouses(id),
    INDEX idx_transfer_no (transfer_no),
    INDEX idx_status (status)
);
```

#### stock_transfer_items (調撥單明細)

```sql
CREATE TABLE stock_transfer_items (
    id INT PRIMARY KEY AUTO_INCREMENT,
    transfer_id INT NOT NULL,
    product_id INT NOT NULL,
    variant_id INT,
    requested_quantity INT NOT NULL,
    shipped_quantity INT,
    received_quantity INT,
    notes NVARCHAR(200),

    FOREIGN KEY (transfer_id) REFERENCES stock_transfers(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_transfer (transfer_id)
);
```

#### stock_adjustments (庫存調整單)

```sql
CREATE TABLE stock_adjustments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    adjustment_no VARCHAR(30) NOT NULL UNIQUE,
    warehouse_id INT NOT NULL,
    adjustment_date DATE NOT NULL,
    product_id INT NOT NULL,
    variant_id INT,
    before_quantity INT NOT NULL,
    after_quantity INT NOT NULL,
    adjustment_quantity INT NOT NULL,
    adjustment_reason ENUM('DAMAGE', 'EXPIRE', 'LOST', 'FOUND', 'ERROR', 'GIFT', 'SAMPLE', 'OTHER') NOT NULL,
    reason_notes TEXT NOT NULL,
    status ENUM('PENDING', 'APPROVED', 'REJECTED', 'COMPLETED') DEFAULT 'PENDING',
    requested_by INT,
    approved_by INT,
    approved_at DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_adjustment_no (adjustment_no)
);
```

---

## 11. API規格

### 11.1 庫存查詢 API

#### 取得庫存列表

```
GET /api/v1/inventory
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| page | int | 頁碼 |
| per_page | int | 每頁筆數 |
| product_id | int | 商品ID |
| warehouse_id | int | 倉庫ID |
| category_id | int | 分類ID |
| status | string | 庫存狀態 (normal/low/warning/critical/out) |
| has_stock | boolean | 只顯示有庫存 |
| keyword | string | 關鍵字搜尋 |

**回應範例**:

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "product_id": 456,
      "product": {
        "sku": "PRD001",
        "name": "白色T-Shirt",
        "barcode": "4710088012345"
      },
      "warehouse_id": 1,
      "warehouse": {
        "code": "WH001",
        "name": "台北門市"
      },
      "quantity": 85,
      "reserved_quantity": 5,
      "available_quantity": 80,
      "safety_stock": 50,
      "status": "normal",
      "cost_amount": 12750,
      "last_movement_date": "2025-12-31T14:30:00Z"
    }
  ],
  "meta": {
    "page": 1,
    "per_page": 20,
    "total": 156
  }
}
```

#### 取得商品庫存卡

```
GET /api/v1/inventory/product/:productId
```

**回應範例**:

```json
{
  "success": true,
  "data": {
    "product": {
      "id": 456,
      "sku": "PRD001",
      "name": "白色T-Shirt",
      "cost_price": 150,
      "selling_price": 299
    },
    "stock_summary": {
      "total_quantity": 317,
      "total_available": 292,
      "total_in_transit": 20,
      "total_cost": 47550
    },
    "by_warehouse": [
      {
        "warehouse_id": 1,
        "warehouse_name": "台北門市",
        "quantity": 85,
        "available": 80,
        "safety_stock": 50,
        "in_transit": 0,
        "status": "normal"
      }
    ],
    "recent_movements": [
      {
        "date": "2025-12-31T14:30:00Z",
        "type": "SALES_OUT",
        "warehouse": "台北門市",
        "quantity": -2,
        "after_quantity": 85,
        "reference_no": "SO202512310001"
      }
    ]
  }
}
```

### 11.2 入庫 API

#### 建立入庫單

```
POST /api/v1/goods-receipts
```

**請求內容**:

```json
{
  "receipt_type": "PURCHASE_IN",
  "receipt_date": "2025-12-31",
  "warehouse_id": 1,
  "source_no": "PO202512310001",
  "supplier_id": 10,
  "items": [
    {
      "product_id": 456,
      "quantity": 50,
      "unit": "件",
      "unit_cost": 150
    }
  ],
  "notes": ""
}
```

### 11.3 盤點 API

#### 建立盤點單

```
POST /api/v1/stock-counts
```

**請求內容**:

```json
{
  "count_type": "FULL",
  "warehouse_id": 1,
  "count_date": "2025-12-31",
  "freeze_inventory": true,
  "assigned_to": 5
}
```

#### 更新盤點數量

```
PUT /api/v1/stock-counts/:id/items/:itemId
```

**請求內容**:

```json
{
  "counted_quantity": 83,
  "variance_reason": "LOST",
  "notes": "疑似遺失"
}
```

#### 完成盤點

```
POST /api/v1/stock-counts/:id/complete
```

### 11.4 調撥 API

#### 建立調撥單

```
POST /api/v1/stock-transfers
```

**請求內容**:

```json
{
  "from_warehouse_id": 1,
  "to_warehouse_id": 2,
  "expected_ship_date": "2025-12-31",
  "transfer_reason": "補充門市庫存",
  "items": [
    {
      "product_id": 456,
      "requested_quantity": 30
    }
  ]
}
```

#### 確認出庫

```
POST /api/v1/stock-transfers/:id/ship
```

**請求內容**:

```json
{
  "items": [
    {
      "item_id": 1,
      "shipped_quantity": 30
    }
  ]
}
```

#### 確認入庫

```
POST /api/v1/stock-transfers/:id/receive
```

**請求內容**:

```json
{
  "items": [
    {
      "item_id": 1,
      "received_quantity": 30
    }
  ]
}
```

### 11.5 庫存警示 API

#### 取得低庫存警示

```
GET /api/v1/inventory/alerts
```

**查詢參數**:

| 參數 | 類型 | 說明 |
|------|------|------|
| warehouse_id | int | 倉庫ID |
| category_id | int | 分類ID |
| level | string | 警示等級 (warning/critical/out) |

**回應範例**:

```json
{
  "success": true,
  "data": {
    "summary": {
      "out_of_stock": 3,
      "critical": 5,
      "warning": 8,
      "low": 7
    },
    "items": [
      {
        "product_id": 789,
        "product_name": "黑色長褲",
        "warehouse_id": 2,
        "warehouse_name": "台中門市",
        "quantity": 0,
        "safety_stock": 30,
        "shortage": 30,
        "alert_level": "out",
        "suggested_action": "PURCHASE",
        "suggested_quantity": 30
      }
    ]
  }
}
```

---

**文件結束**

[返回主文件](SA_00_主文件.md) | [上一章：銷售模組](SA_02_銷售模組.md) | [下一章：採購模組](SA_04_採購模組.md)
